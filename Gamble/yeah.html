<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Casino Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0f0e17;
            --secondary: #1f1b2e;
            --accent: #ff5e57;
            --gold: #ffd700;
            --text: #fffffe;
            --success: #2ecc71;
            --danger: #ff5e57;
            --warning: #f39c12;
            --info: #3498db;
            --card-red: #ff5e57;
            --card-black: #0f0e17;
            --highlight: #ff8906;
            --background: #0f0e17;
            --surface: #1f1b2e;
            --diamond: #b9f2ff;
            --ruby: #e0115f;
            --emerald: #50c878;
            --sapphire: #0f52ba;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body.terms-locked {
            overflow: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 94, 87, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 215, 0, 0.05) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--gold), var(--accent), var(--gold));
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            font-weight: 800;
            animation: gradientShift 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .balance {
            background: rgba(0, 0, 0, 0.4);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .balance::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: scan 2s infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .balance:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 40px rgba(255, 215, 0, 0.2);
        }

        .balance h2 {
            color: var(--gold);
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            position: relative;
            z-index: 1;
        }

        .balance-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .loan-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .loan-metric {
            background: rgba(0, 0, 0, 0.35);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            text-align: center;
        }

        .metric-label {
            display: block;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--gold);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .loan-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .terms-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            padding: 20px;
        }

        .terms-overlay.active {
            display: flex;
        }

        .terms-modal {
            max-width: 520px;
            width: 100%;
            background: rgba(15, 14, 23, 0.95);
            border-radius: 18px;
            border: 1px solid rgba(255, 215, 0, 0.25);
            padding: 30px;
            text-align: left;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .terms-modal h2 {
            color: var(--gold);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terms-modal p {
            opacity: 0.85;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .terms-modal label {
            display: block;
            margin-top: 18px;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gold);
        }

        .terms-modal input {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.4);
            color: white;
            font-size: 1.05rem;
        }

        .terms-modal input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(255, 94, 87, 0.3);
        }

        .terms-actions {
            margin-top: 22px;
            display: flex;
            justify-content: center;
        }

        .terms-actions .btn {
            width: 100%;
        }

        .share-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
            margin: 25px 0;
        }

        .share-card {
            background: rgba(0, 0, 0, 0.45);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .share-card.completed {
            border-color: var(--success);
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.35);
        }

        .share-card h3 {
            margin-bottom: 10px;
            color: var(--gold);
        }

        .share-card p {
            font-size: 0.95rem;
            opacity: 0.85;
            margin-bottom: 15px;
        }

        .referral-link-box {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            background: rgba(0, 0, 0, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
        }

        .referral-link-box code {
            flex: 1;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .referral-summary {
            margin-top: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }

        .summary-card {
            background: rgba(0, 0, 0, 0.45);
            border-radius: 15px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .summary-card .label {
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .summary-card .value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--gold);
            margin-top: 6px;
        }

        .referral-table, .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.35);
            border-radius: 12px;
            overflow: hidden;
        }

        .referral-table th, .referral-table td,
        .leaderboard-table th, .leaderboard-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            text-align: left;
            font-size: 0.95rem;
        }

        .leaderboard-table tr.highlight {
            background: rgba(255, 215, 0, 0.12);
        }

        .leaderboard-table th {
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .roulette-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 25px 0;
        }

        .roulette-wheel {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background:
                radial-gradient(circle at center, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.8) 60%, rgba(0,0,0,1) 100%),
                repeating-conic-gradient(#d63031 0deg 10deg, #2d3436 10deg 20deg);
            border: 6px solid var(--gold);
            position: relative;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            transition: transform 3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .roulette-wheel::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60%;
            height: 60%;
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.1), rgba(0,0,0,0.6));
            transform: translate(-50%, -50%);
        }

        .roulette-pointer {
            position: absolute;
            top: -22px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 14px solid transparent;
            border-right: 14px solid transparent;
            border-bottom: 24px solid var(--gold);
        }

        .roulette-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle at center, var(--gold), #d4ac0d);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            color: #2c3e50;
        }

        .roulette-last-results {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .roulette-chip {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .roulette-chip.red {
            background: #d63031;
            color: #fff;
        }

        .roulette-chip.black {
            background: #2d3436;
            color: #fff;
        }

        .roulette-chip.green {
            background: #1abc9c;
            color: #0b3d3d;
        }

        .roulette-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .roulette-stat {
            background: rgba(0, 0, 0, 0.35);
            padding: 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            text-align: center;
        }

        .roulette-stat .stat-label {
            display: block;
            font-size: 0.85rem;
            opacity: 0.7;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .roulette-stat .stat-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--gold);
        }

        .stat-item {
            padding: 8px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin: 5px;
            font-size: 0.9rem;
        }

        .stat-item i {
            margin-right: 5px;
            color: var(--gold);
        }

        .progress-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--highlight));
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .tabs-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .tab-btn {
            background: rgba(0, 0, 0, 0.4);
            color: var(--text);
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .tab-btn:hover::before {
            left: 100%;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 94, 87, 0.3);
        }

        .tab-btn.active {
            background: linear-gradient(45deg, var(--accent), #c0392b);
            box-shadow: 0 8px 25px rgba(255, 94, 87, 0.4);
            transform: translateY(-2px);
        }

        .game-tab {
            display: none;
            background: rgba(0, 0, 0, 0.4);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            min-height: 600px;
            animation: fadeInUp 0.6s ease;
            position: relative;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .game-tab.active {
            display: block;
        }

        .game-title {
            font-size: 2.2rem;
            margin-bottom: 20px;
            color: var(--gold);
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            font-weight: 700;
        }

        .game-description {
            margin-bottom: 30px;
            text-align: center;
            opacity: 0.9;
            line-height: 1.8;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            font-size: 1.1rem;
        }

        .game-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .btn {
            background: linear-gradient(45deg, var(--accent), #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 94, 87, 0.5);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn-gold {
            background: linear-gradient(45deg, var(--gold), #f39c12);
            color: #333;
        }

        .btn-gold:hover {
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }

        .btn-success {
            background: linear-gradient(45deg, var(--success), #27ae60);
        }

        .btn-success:hover {
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.5);
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger), #c0392b);
        }

        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.5);
        }

        .btn-warning {
            background: linear-gradient(45deg, var(--warning), #d68910);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, var(--info), #2980b9);
        }

        .btn-diamond {
            background: linear-gradient(45deg, var(--diamond), #00b4d8);
            color: #333;
        }

        .btn-ruby {
            background: linear-gradient(45deg, var(--ruby), #c81d25);
        }

        .btn-emerald {
            background: linear-gradient(45deg, var(--emerald), #1a936f);
        }

        .btn-sapphire {
            background: linear-gradient(45deg, var(--sapphire), #1e56a0);
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--gold);
            font-size: 1.1rem;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.4);
            color: white;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(255, 94, 87, 0.3);
            transform: scale(1.02);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Game-specific styles */
        .slots-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            position: relative;
        }

        .slot {
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.6);
            border: 3px solid var(--gold);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .slot::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        .slot.spinning {
            animation: slotSpin 0.1s infinite linear;
        }

        @keyframes slotSpin {
            0% { transform: rotateX(0deg); }
            25% { transform: rotateX(90deg); }
            50% { transform: rotateX(180deg); }
            75% { transform: rotateX(270deg); }
            100% { transform: rotateX(360deg); }
        }

        .slots-paytable {
            margin: 20px auto;
            max-width: 600px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .paytable-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--gold);
            font-weight: 600;
        }

        .paytable-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .paytable-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .paytable-symbol {
            font-size: 1.8rem;
            margin-right: 10px;
        }

        .paytable-multiplier {
            font-weight: bold;
            color: var(--gold);
        }

        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            max-width: 400px;
            margin: 30px auto;
        }

        .mine-cell {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .mine-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        }

        .mine-cell:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .mine-cell.revealed {
            background: rgba(46, 204, 113, 0.3);
            border-color: var(--success);
            transform: scale(1);
        }

        .mine-cell.mine {
            background: rgba(255, 94, 87, 0.7);
            border-color: var(--danger);
            animation: explode 0.5s ease;
        }

        @keyframes explode {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .mines-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .mine-option {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
            min-width: 100px;
            text-align: center;
            font-weight: 600;
        }

        .mine-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .mine-option.selected {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 4px 15px rgba(255, 94, 87, 0.4);
        }

        .mines-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }

        .mines-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .mines-stat span {
            color: var(--gold);
            font-weight: bold;
        }

        .crash-game {
            text-align: center;
            padding: 20px;
            position: relative;
        }

        .crash-multiplier {
            font-size: 4rem;
            color: var(--gold);
            margin: 30px 0;
            font-weight: bold;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            animation: pulse 1s infinite alternate;
            position: relative;
        }

        .crash-multiplier::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            animation: pulseBorder 1.5s infinite;
            pointer-events: none;
        }

        @keyframes pulseBorder {
            0% { opacity: 0; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0; transform: scale(1.1); }
        }

        @keyframes pulse {
            from { transform: scale(1); text-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
            to { transform: scale(1.05); text-shadow: 0 0 40px rgba(255, 215, 0, 1); }
        }

        .crash-history {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .crash-history-item {
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .crash-history-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        }

        .crash-history-item.crash {
            background: rgba(255, 94, 87, 0.3);
            color: var(--danger);
        }

        .crash-history-item.cashout {
            background: rgba(46, 204, 113, 0.3);
            color: var(--success);
        }

        .crash-auto {
            margin: 20px 0;
        }

        .auto-settings {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .auto-setting {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .auto-setting label {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .coinflip-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 40px 0;
        }

        .coin {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            margin: 30px 0;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s ease-out;
            background: linear-gradient(145deg, #e6e6e6, #ffffff);
            border: 5px solid var(--gold);
        }

        .coin::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 50%;
        }

        .coin.flipping {
            animation: coinFlip 4s ease-out;
        }

        @keyframes coinFlip {
            0% { transform: rotateY(0deg) rotateX(0deg); }
            25% { transform: rotateY(900deg) rotateX(180deg); }
            50% { transform: rotateY(1800deg) rotateX(360deg); }
            75% { transform: rotateY(2700deg) rotateX(540deg); }
            100% { transform: rotateY(3600deg) rotateX(720deg); }
        }

        .coin-heads {
            position: absolute;
            backface-visibility: hidden;
            color: #2e86de;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            font-weight: bold;
        }

        .coin-tails {
            position: absolute;
            backface-visibility: hidden;
            transform: rotateY(180deg);
            color: #ff6b6b;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            font-weight: bold;
        }

        .blackjack-area {
            margin: 30px 0;
        }

        .hand {
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .hand::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        }

        .hand-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--gold);
            font-weight: 600;
            text-align: center;
        }

        .blackjack-cards {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .card {
            width: 90px;
            height: 130px;
            background: white;
            color: black;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.8rem;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            animation: cardDeal 0.5s ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 12px;
        }

        @keyframes cardDeal {
            from { 
                transform: translateY(-50px) rotateY(180deg);
                opacity: 0;
            }
            to { 
                transform: translateY(0) rotateY(0deg);
                opacity: 1;
            }
        }

        .card.red {
            color: var(--card-red);
        }

        .card.black {
            color: var(--card-black);
        }

        .card-value {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 1.2rem;
        }

        .card-suit {
            font-size: 2.5rem;
        }

        .hand-value {
            font-size: 1.4rem;
            margin-top: 15px;
            font-weight: 600;
            color: var(--gold);
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .blackjack-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .blackjack-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .blackjack-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .blackjack-stat span {
            color: var(--gold);
            font-weight: bold;
        }

        .game-result {
            margin: 25px 0;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.3rem;
            animation: resultPop 0.6s ease;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .game-result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            border-radius: 12px;
        }

        @keyframes resultPop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        .win {
            background: rgba(46, 204, 113, 0.3);
            color: var(--success);
            border: 2px solid var(--success);
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.3);
        }

        .lose {
            background: rgba(255, 94, 57, 0.3);
            color: var(--danger);
            border: 2px solid var(--danger);
            box-shadow: 0 0 20px rgba(255, 94, 57, 0.3);
        }

        .neutral {
            background: rgba(52, 152, 219, 0.3);
            color: var(--info);
            border: 2px solid var(--info);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
        }

        .countdown {
            font-size: 1.4rem;
            color: var(--gold);
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .history-log {
            max-height: 250px;
            overflow-y: auto;
            margin-top: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .history-log::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            border-radius: 12px;
        }

        .history-entry {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--accent);
            transition: transform 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .history-entry::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        }

        .history-entry:hover {
            transform: translateX(5px);
        }

        .history-entry.win {
            border-left-color: var(--success);
        }

        .history-entry.lose {
            border-left-color: var(--danger);
        }

        .bet-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .bet-btn {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .bet-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.3s ease;
        }

        .bet-btn:hover::before {
            left: 100%;
        }

        .bet-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--gold);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px 25px;
            border-radius: 12px;
            border-left: 5px solid var(--gold);
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.4s ease;
            max-width: 350px;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
        }

        .notification i {
            margin-right: 10px;
            font-size: 1.5rem;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification.info {
            border-left-color: var(--info);
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 30px;
            border-radius: 20px;
            border: 3px solid var(--gold);
            z-index: 4000;
            text-align: center;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            transition: transform 0.5s ease;
            width: 90%;
            max-width: 500px;
        }

        .achievement-popup::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            border-radius: 20px;
        }

        .achievement-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .achievement-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .achievement-title {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 10px;
            font-weight: bold;
        }

        .achievement-description {
            font-size: 1.2rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .achievement-reward {
            font-size: 1.5rem;
            color: var(--success);
            font-weight: bold;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .achievement-card {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .achievement-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        .achievement-card.unlocked {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .achievement-card .achievement-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .achievement-name {
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .achievement-description {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .achievement-reward {
            color: var(--success);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .achievement-progress {
            margin-top: 10px;
            height: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .achievement-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--highlight));
            transition: width 0.3s ease;
        }

        .jackpot-meter {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            position: relative;
        }

        .jackpot-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--highlight));
            transition: width 0.5s ease;
            position: relative;
        }

        .jackpot-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .jackpot-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .jackpot-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .jackpot-info span {
            color: var(--gold);
            font-weight: bold;
        }

        .bonus-wheel {
            width: 300px;
            height: 300px;
            margin: 30px auto;
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid var(--gold);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.35), rgba(0,0,0,0));
        }

        .bonus-wheel::before {
            content: '';
            position: absolute;
            inset: -12px;
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(255, 215, 0, 0.25), transparent 65%);
            z-index: -1;
        }

        .wheel-center {
            position: absolute;
            width: 60px;
            height: 60px;
            background: var(--gold);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #333;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .wheel-center:hover {
            filter: brightness(1.1);
        }

        .wheel-center.disabled {
            cursor: default;
            filter: grayscale(0.2) brightness(0.9);
        }

        .wheel-spin {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            overflow: hidden;
        }

        .wheel-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid var(--gold);
            z-index: 5;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));
        }

        .wheel-spin::before {
            content: '';
            position: absolute;
            inset: 5px;
            border-radius: 50%;
            box-shadow: inset 0 0 25px rgba(0,0,0,0.35);
            pointer-events: none;
        }

        .wheel-labels {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 3;
        }

        .wheel-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center;
        }

        .wheel-label span {
            display: block;
            font-weight: 700;
            letter-spacing: 1px;
            color: #fff;
            text-shadow: 0 2px 6px rgba(0,0,0,0.6);
            transform-origin: center;
            text-transform: uppercase;
            text-align: center;
            white-space: nowrap;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .slot {
                width: 80px;
                height: 80px;
                font-size: 3rem;
            }
            
            .mine-cell {
                width: 55px;
                height: 55px;
                font-size: 1.5rem;
            }
            
            .coin {
                width: 150px;
                height: 150px;
                font-size: 4rem;
            }
            
            .card {
                width: 70px;
                height: 100px;
                font-size: 1.4rem;
            }
            
            .card-suit {
                font-size: 2rem;
            }
            
            .game-title {
                font-size: 1.8rem;
            }
            
            .tab-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .bonus-wheel {
                width: 250px;
                height: 250px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .balance h2 {
                font-size: 2rem;
            }
            
            .tab-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .game-tab {
                padding: 20px;
            }
            
            .bonus-wheel {
                width: 200px;
                height: 200px;
            }
        }

        @keyframes buttonClick {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        .btn-click {
            animation: buttonClick 0.3s ease;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--highlight);
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-icon" id="achievementIcon">🏆</div>
        <div class="achievement-title" id="achievementTitle">Achievement Unlocked!</div>
        <div class="achievement-description" id="achievementDesc">You did something awesome!</div>
        <div class="achievement-reward" id="achievementReward">+$1000</div>
    </div>

    <div class="terms-overlay" id="termsOverlay">
        <div class="terms-modal">
            <h2><i class="fas fa-scale-balanced"></i> Terms of Use</h2>
            <p>CASINO EMPIRE is a fictional gambling simulation for entertainment only. All chips, balances, and rewards are virtual and hold no real-world value.</p>
            <p>By continuing, you confirm you are not expecting real payouts, accept simulated casino risks, and acknowledge that we do not promote real-money gambling.</p>
            <p>Your bankroll and stats are stored locally on this device with a protected session token. Clearing storage or switching devices resets progress.</p>

            <label for="playerUsername"><i class="fas fa-user"></i> Choose a display name</label>
            <input type="text" id="playerUsername" maxlength="24" placeholder="Enter a name for the leaderboard" autocomplete="off">

            <div class="terms-actions">
                <button class="btn btn-gold" onclick="acceptTerms()">
                    <i class="fas fa-check"></i> Accept &amp; Continue
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🎰 CASINO EMPIRE 🎰</h1>
            <p>The ultimate high-stakes gambling experience - Can you beat the house? - This game does NOT promote gambling</p>
        </div>

        <div class="controls">
            <button class="btn btn-gold" onclick="resetGame()">
                <i class="fas fa-sync-alt"></i> Reset Game
            </button>
            <button class="btn btn-info" onclick="showHelp()">
                <i class="fas fa-question-circle"></i> Help
            </button>
        </div>

        <div class="balance">
            <h2>💰 Balance: $<span id="balance">3,650</span></h2>
            <div class="balance-stats">
                <div class="stat-item">
                    <i class="fas fa-coins"></i> Wagered: $<span id="totalWagered">1,050</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-trophy"></i> Won: $<span id="totalWon">700</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-dice"></i> Games: <span id="gamesPlayed">5</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-user"></i> Player: <span id="playerName">ininin</span>
                </div>
            </div>
        </div>

        <div class="progress-section">
            <h3 style="color: var(--gold); margin-bottom: 10px;">🎯 Progress to 100T Empire</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 3.65e-09%;"></div>
            </div>
            <div class="progress-labels">
                <span>$<span id="progressAmount">3,650</span></span>
                <span><span id="progressPercent">0.000000</span>%</span>
                <span>$100,000,000,000,000</span>
            </div>
        </div>

        <div class="tabs-container">
            <button class="tab-btn" data-tab="loan">
                <i class="fas fa-hand-holding-usd"></i> Stake Loan
            </button>
            <button class="tab-btn" data-tab="blackjack">
                <i class="fas fa-cards"></i> Blackjack
            </button>
            <button class="tab-btn" data-tab="coinflip">
                <i class="fas fa-coins"></i> Coinflip
            </button>
            <button class="tab-btn" data-tab="roulette">
                <i class="fas fa-circle-notch"></i> Roulette
            </button>
            <button class="tab-btn" data-tab="crash">
                <i class="fas fa-rocket"></i> Crash
            </button>
            <button class="tab-btn" data-tab="slots">
                <i class="fas fa-slot-machine"></i> Slots
            </button>
            <button class="tab-btn" data-tab="mines">
                <i class="fas fa-bomb"></i> Mines
          
            </button>
            <button class="tab-btn" data-tab="bonus">
                <i class="fas fa-gift"></i> Bonus
            </button>
            <button class="tab-btn" data-tab="achievements">
                <i class="fas fa-trophy"></i> Achievements
            </button>
            <button class="tab-btn active" data-tab="referral">
                <i class="fas fa-users"></i> Referral
            </button>
            <button class="tab-btn" data-tab="leaderboard">
                <i class="fas fa-crown"></i> Leaderboard
            </button>
        </div>

        <!-- Loan Tab -->
        <div class="game-tab" id="loan-tab">
            <h2 class="game-title"><i class="fas fa-landmark"></i> Stake Loan Service</h2>
            <p class="game-description">Front-load your bets with a short-term casino stake. Borrow up to $100,000 every 10 minutes and repay before the timer expires. Interest compounds every single minute, so settle early!</p>

            <div class="game-content">
                <div class="loan-overview">
                    <div class="loan-metric">
                        <span class="metric-label"><i class="fas fa-money-bill-wave"></i> Outstanding Stake</span>
                        <span class="metric-value" id="loanOutstanding">$0</span>
                    </div>
                    <div class="loan-metric">
                        <span class="metric-label"><i class="fas fa-percentage"></i> Current Interest</span>
                        <span class="metric-value" id="loanInterest">0.0%</span>
                    </div>
                    <div class="loan-metric">
                        <span class="metric-label"><i class="fas fa-hourglass-half"></i> Due In</span>
                        <span class="metric-value" id="loanTimer">Ready</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="loanAmount"><i class="fas fa-coins"></i> Request Stake Amount (max $100,000)</label>
                    <input type="number" id="loanAmount" min="1000" max="100000" step="1000" placeholder="Enter amount">
                    <div class="bet-controls">
                        <button class="bet-btn" onclick="setLoanAmount(10000)">$10K</button>
                        <button class="bet-btn" onclick="setLoanAmount(25000)">$25K</button>
                        <button class="bet-btn" onclick="setLoanAmount(50000)">$50K</button>
                        <button class="bet-btn" onclick="setLoanAmount(100000)">$100K</button>
                    </div>
                </div>

                <div class="loan-actions">
                    <button class="btn" id="loanRequestBtn" onclick="requestLoan()">
                        <i class="fas fa-hand-holding-usd"></i> Request Stake
                    </button>
                    <button class="btn btn-warning" id="loanRepayBtn" onclick="repayLoan()" disabled="">
                        <i class="fas fa-undo"></i> Repay Stake
                    </button>
                    <button class="btn btn-danger" id="loanForfeitBtn" onclick="forfeitLoan()" disabled="">
                        <i class="fas fa-skull-crossbones"></i> Forfeit (Severe Penalty)
                    </button>
                </div>

                <div id="loanWarning" class="countdown"></div>
                <div id="loanResult" class="game-result"></div>

                <div class="history-log" id="loanHistory"></div>
            </div>
        </div>

        <!-- Blackjack Tab -->
        <div class="game-tab" id="blackjack-tab">
            <h2 class="game-title"><i class="fas fa-cards"></i> Blackjack (House Edge: 15%)</h2>
            <p class="game-description">Beat the dealer to 21, but the house always has an edge. Dealer hits on soft 17. Blackjack pays 3:2, insurance pays 2:1. Try to win big with double down and splits!</p>
            
            <div class="game-content">
                <div class="input-group">
                    <label><i class="fas fa-coins"></i> Bet Amount:</label>
                    <input type="number" id="blackjackBet" placeholder="Enter bet" min="1" value="10">
                    <div class="bet-controls">
                        <button class="bet-btn" onclick="setBetAmount('blackjackBet', 10)">$10</button>
                        <button class="bet-btn" onclick="setBetAmount('blackjackBet', 100)">$100</button>
                        <button class="bet-btn" onclick="setBetAmount('blackjackBet', 1000)">$1K</button>
                        <button class="bet-btn" onclick="setBetAmount('blackjackBet', 10000)">$10K</button>
                    </div>
                </div>
                
                <div class="blackjack-stats">
                    <div class="blackjack-stat">
                        <i class="fas fa-chart-line"></i> Win Rate: <span id="blackjackWinRate">0%</span>
                    </div>
                    <div class="blackjack-stat">
                        <i class="fas fa-coins"></i> Profit: <span id="blackjackProfit">$0</span>
                    </div>
                    <div class="blackjack-stat">
                        <i class="fas fa-bolt"></i> Streak: <span id="blackjackStreak">0</span>
                    </div>
                </div>
                
                <div class="blackjack-area" id="blackjackGame">
                    <button class="btn" onclick="startBlackjack()" id="blackjackStart">
                        <i class="fas fa-play"></i> Start Game
                    </button>
                    
                    <div id="blackjackPlayingArea" style="display: none;">
                        <div class="hand">
                            <h3 class="hand-title"><i class="fas fa-crown"></i> Dealer's Hand</h3>
                            <div class="blackjack-cards" id="dealerHand"></div>
                            <div class="hand-value">Value: <span id="dealerValue">?</span></div>
                        </div>
                        
                        <div class="hand">
                            <h3 class="hand-title"><i class="fas fa-user"></i> Your Hand</h3>
                            <div class="blackjack-cards" id="playerHand"></div>
                            <div class="hand-value">Value: <span id="playerValue">0</span></div>
                        </div>
                        
                        <div class="blackjack-actions" id="blackjackActions">
                            <button class="btn btn-success" onclick="blackjackHit()">
                                <i class="fas fa-plus"></i> Hit
                            </button>
                            <button class="btn btn-danger" onclick="blackjackStand()">
                                <i class="fas fa-hand-paper"></i> Stand
                            </button>
                            <button class="btn btn-gold" onclick="blackjackDouble()">
                                <i class="fas fa-times"></i> Double
                            </button>
                            <button class="btn btn-info" onclick="blackjackSplit()" id="splitBtn" style="display: none;">
                                <i class="fas fa-cut"></i> Split
                            </button>
                            <button class="btn btn-warning" onclick="blackjackInsurance()" id="insuranceBtn" style="display: none;">
                                <i class="fas fa-shield-alt"></i> Insurance
                            </button>
                        </div>
                    </div>
                    
                    <div id="blackjackResult" class="game-result"></div>
                </div>
                
                <div class="history-log" id="blackjackHistory"></div>
            </div>
        </div>

        <!-- Coinflip Tab -->
        <div class="game-tab" id="coinflip-tab">
            <h2 class="game-title"><i class="fas fa-coins"></i> Coinflip (House Edge: 10%)</h2>
            <p class="game-description">50/50 chance, but the house takes a cut. Win rate: 45%. Try your luck with double or nothing streaks for bigger rewards!</p>
            
            <div class="game-content">
                <div class="input-group">
                    <label><i class="fas fa-coins"></i> Bet Amount:</label>
                    <input type="number" id="coinflipBet" placeholder="Enter bet" min="1" value="10">
                    <div class="bet-controls">
                        <button class="bet-btn" onclick="setBetAmount('coinflipBet', 10)">$10</button>
                        <button class="bet-btn" onclick="setBetAmount('coinflipBet', 100)">$100</button>
                        <button class="bet-btn" onclick="setBetAmount('coinflipBet', 1000)">$1K</button>
                        <button class="bet-btn" onclick="setBetAmount('coinflipBet', 10000)">$10K</button>
                    </div>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-dice"></i> Choose Side:</label>
                    <select id="coinflipChoice">
                        <option value="heads">🔵 Heads (1.9x)</option>
                        <option value="tails">🔴 Tails (1.9x)</option>
                    </select>
                </div>
                
                <div class="bet-controls">
                    <button class="btn" onclick="flipCoin()" id="coinflipBtn">
                        <i class="fas fa-random"></i> Flip Coin
                    </button>
                    <button class="btn btn-gold" onclick="startStreak()" id="streakBtn">
                        <i class="fas fa-bolt"></i> Start Streak (3x)
                    </button>
                </div>
                
                <div class="coinflip-container">
                    <div class="coin" id="coin">
                        <div class="coin-heads">H</div>
                        <div class="coin-tails">T</div>
                    </div>
                </div>
                
                <div class="bet-controls">
                    <button class="btn btn-success" onclick="doubleOrNothing()" id="doubleBtn" style="display: none;">
                        <i class="fas fa-angle-double-up"></i> Double or Nothing
                    </button>
                    <button class="btn btn-danger" onclick="cashoutStreak()" id="cashoutStreakBtn" style="display: none;">
                        <i class="fas fa-hand-holding-usd"></i> Cash Out
                    </button>
                </div>
                
                <div id="coinflipResult" class="game-result"></div>
                
                <div class="history-log" id="coinflipHistory"><div class="history-entry lose">💔 HEADS! You lost 1000!</div></div>
            </div>
        </div>

        <!-- Roulette Tab -->
        <div class="game-tab" id="roulette-tab">
            <h2 class="game-title"><i class="fas fa-circle-notch"></i> Roulette (House Edge: 8%)</h2>
            <p class="game-description">Bet on colors, dozens, or a single lucky number. The wheel is slightly biased toward the house—make every chip count.</p>

            <div class="game-content">
                <div class="input-group">
                    <label><i class="fas fa-coins"></i> Bet Amount:</label>
                    <input type="number" id="rouletteBet" placeholder="Enter bet" min="1" value="50">
                    <div class="bet-controls">
                        <button class="bet-btn" onclick="setBetAmount('rouletteBet', 50)">$50</button>
                        <button class="bet-btn" onclick="setBetAmount('rouletteBet', 250)">$250</button>
                        <button class="bet-btn" onclick="setBetAmount('rouletteBet', 500)">$500</button>
                        <button class="bet-btn" onclick="setBetAmount('rouletteBet', 1000)">$1K</button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="rouletteBetType"><i class="fas fa-sliders-h"></i> Bet Type:</label>
                    <select id="rouletteBetType" onchange="handleRouletteBetTypeChange()">
                        <option value="red">Red</option>
                        <option value="black">Black</option>
                        <option value="even">Even</option>
                        <option value="odd">Odd</option>
                        <option value="low">1-18</option>
                        <option value="high">19-36</option>
                        <option value="dozen1">1st Dozen (1-12)</option>
                        <option value="dozen2">2nd Dozen (13-24)</option>
                        <option value="dozen3">3rd Dozen (25-36)</option>
                        <option value="single">Straight Up (Single Number)</option>
                    </select>
                </div>

                <div class="input-group" id="rouletteNumberGroup" style="display:none;">
                    <label for="rouletteNumber"><i class="fas fa-bullseye"></i> Target Number (0-36)</label>
                    <input type="number" id="rouletteNumber" min="0" max="36" placeholder="Pick a number">
                </div>

                <div class="bet-controls">
                    <button class="btn" onclick="spinRoulette()" id="rouletteSpinBtn">
                        <i class="fas fa-sync"></i> Spin Wheel
                    </button>
                    <button class="btn btn-info" onclick="repeatRouletteBet()" id="rouletteRepeatBtn">
                        <i class="fas fa-redo-alt"></i> Repeat Bet
                    </button>
                </div>

                <div class="roulette-section">
                    <div class="roulette-wheel" id="rouletteWheel">
                        <div class="roulette-pointer"></div>
                        <div class="roulette-center">🎲</div>
                    </div>
                    <div class="roulette-last-results" id="rouletteRecent"><div class="roulette-chip red">5</div></div>
                </div>

                <div class="roulette-stats">
                    <div class="roulette-stat">
                        <span class="stat-label">Last Result</span>
                        <span class="stat-value" id="rouletteLastLabel">5 RED</span>
                    </div>
                    <div class="roulette-stat">
                        <span class="stat-label">Win Rate</span>
                        <span class="stat-value" id="rouletteWinRate">100%</span>
                    </div>
                    <div class="roulette-stat">
                        <span class="stat-label">Best Hit</span>
                        <span class="stat-value" id="rouletteMaxPayout">$100</span>
                    </div>
                </div>

                <div id="rouletteResult" class="game-result"></div>
                <div class="history-log" id="rouletteHistory"><div class="history-entry win">🎡 5 RED! Won $100!</div></div>
            </div>
        </div>

        <!-- Slots Tab -->
        <div class="game-tab" id="slots-tab">
            <h2 class="game-title"><i class="fas fa-slot-machine"></i> Slots (House Edge: 20%)</h2>
            <p class="game-description">Spin for jackpots, but the odds are heavily against you! Special bonus rounds and progressive jackpots can make you rich instantly!</p>
            
            <div class="game-content">
                <div class="input-group">
                    <label><i class="fas fa-coins"></i> Bet Amount:</label>
                    <input type="number" id="slotsBet" placeholder="Enter bet" min="1" value="10">
                    <div class="bet-controls">
                        <button class="bet-btn" onclick="setBetAmount('slotsBet', 10)">$10</button>
                        <button class="bet-btn" onclick="setBetAmount('slotsBet', 100)">$100</button>
                        <button class="bet-btn" onclick="setBetAmount('slotsBet', 1000)">$1K</button>
                        <button class="bet-btn" onclick="setBetAmount('slotsBet', 10000)">$10K</button>
                    </div>
                </div>
                
                <div class="jackpot-info">
                    <span><i class="fas fa-trophy"></i> Jackpot: $<span id="jackpotAmount">10,000</span></span>
                    <span>Next Bonus: <span id="bonusSpins">5</span> spins</span>
                </div>
                <div class="jackpot-meter">
                    <div class="jackpot-fill" id="jackpotFill" style="width: 0%"></div>
                    <div class="jackpot-value" id="jackpotValue">0.0%</div>
                </div>
                
                <button class="btn" onclick="spinSlots()" id="slotsBtn">
                    <i class="fas fa-redo"></i> Spin Slots
                </button>
                <div class="slots-container">
                    <div class="slot" id="slot1">🍒</div>
                    <div class="slot" id="slot2">🍋</div>
                    <div class="slot" id="slot3">🍊</div>
                </div>
                
                <div class="slots-paytable">
                    <h3 class="paytable-title"><i class="fas fa-list-ol"></i> Paytable</h3>
                    <div class="paytable-grid">
                        <div class="paytable-item">
                            <div class="paytable-symbol">💎💎💎</div>
                            <div class="paytable-multiplier">50x</div>
                        </div>
                        <div class="paytable-item">
                            <div class="paytable-symbol">⭐️⭐️⭐️</div>
                            <div class="paytable-multiplier">25x</div>
                        </div>
                        <div class="paytable-item">
                            <div class="paytable-symbol">🔔🔔🔔</div>
                            <div class="paytable-multiplier">15x</div>
                        </div>
                        <div class="paytable-item">
                            <div class="paytable-symbol">🍀🍀🍀</div>
                            <div class="paytable-multiplier">10x</div>
                        </div>
                        <div class="paytable-item">
                            <div class="paytable-symbol">7️⃣7️⃣7️⃣</div>
                            <div class="paytable-multiplier">5x</div>
                        </div>
                        <div class="paytable-item">
                            <div class="paytable-symbol">🍒🍒🍒</div>
                            <div class="paytable-multiplier">3x</div>
                        </div>
                        <div class="paytable-item">
                            <div class="paytable-symbol">🍋🍋🍋</div>
                            <div class="paytable-multiplier">2x</div>
                        </div>
                        <div class="paytable-item">
                            <div class="paytable-symbol">🍊🍊🍊</div>
                            <div class="paytable-multiplier">2x</div>
                        </div>
                        <div class="paytable-item">
                            <div class="paytable-symbol">Any 2</div>
                            <div class="paytable-multiplier">1.5x</div>
                        </div>
                    </div>
                </div>
                
                <div id="slotsResult" class="game-result"></div>
                
                <div class="history-log" id="slotsHistory"></div>
            </div>
        </div>

        <!-- Mines Tab -->
        <div class="game-tab" id="mines-tab">
            <h2 class="game-title"><i class="fas fa-bomb"></i> Mines (House Edge: 25%)</h2>
            <p class="game-description">Find gems while avoiding bombs. Cash out before you explode! Higher mine counts = bigger risks but better rewards. Unlock special power-ups as you play!</p>
            
            <div class="game-content">
                <div class="input-group">
                    <label><i class="fas fa-coins"></i> Bet Amount:</label>
                    <input type="number" id="minesBet" placeholder="Enter bet" min="1" value="10">
                    <div class="bet-controls">
                        <button class="bet-btn" onclick="setBetAmount('minesBet', 10)">$10</button>
                        <button class="bet-btn" onclick="setBetAmount('minesBet', 100)">$100</button>
                        <button class="bet-btn" onclick="setBetAmount('minesBet', 1000)">$1K</button>
                        <button class="bet-btn" onclick="setBetAmount('minesBet', 10000)">$10K</button>
                    </div>
                </div>
                
                <div class="mines-controls" id="minesDifficulty">
                    <div class="mine-option selected" data-mines="3" onclick="selectMineOption(this, 3)">
                        <i class="fas fa-gem"></i> 3 Mines (3x)
                    </div>
                    <div class="mine-option" data-mines="5" onclick="selectMineOption(this, 5)">
                        <i class="fas fa-gem"></i> 5 Mines (5x)
                    </div>
                    <div class="mine-option" data-mines="7" onclick="selectMineOption(this, 7)">
                        <i class="fas fa-gem"></i> 7 Mines (8x)
                    </div>
                    <div class="mine-option" data-mines="10" onclick="selectMineOption(this, 10)">
                        <i class="fas fa-gem"></i> 10 Mines (12x)
                    </div>
                </div>
                
                <div class="mines-stats">
                    <div class="mines-stat">
                        <i class="fas fa-chart-line"></i> Win Rate: <span id="minesWinRate">0%</span>
                    </div>
                    <div class="mines-stat">
                        <i class="fas fa-coins"></i> Profit: <span id="minesProfit">$0</span>
                    </div>
                    <div class="mines-stat">
                        <i class="fas fa-bomb"></i> Mines Hit: <span id="minesHit">0</span>
                    </div>
                </div>
                
                <button class="btn" onclick="startMines()" id="minesStart">
                    <i class="fas fa-play"></i> Start Game
                </button>
                <button class="btn btn-gold" onclick="cashoutMines()" id="minesCashout" style="display:none;">
                    <i class="fas fa-hand-holding-usd"></i> Cash Out
                </button>
                <button class="btn btn-info" onclick="usePowerup('reveal')" id="revealPowerup" style="display:none;">
                    <i class="fas fa-eye"></i> Reveal (1)
                </button>
                <button class="btn btn-success" onclick="usePowerup('shield')" id="shieldPowerup" style="display:none;">
                    <i class="fas fa-shield-alt"></i> Shield (1)
                </button>
                
                <div id="minesResult" class="game-result"></div>
                <div class="mines-grid" id="minesGrid"></div>
                
                <div class="history-log" id="minesHistory"></div>
            </div>
        </div>

        <!-- Crash Tab -->
        <div class="game-tab" id="crash-tab">
            <h2 class="game-title"><i class="fas fa-rocket"></i> Crash (House Edge: 30%)</h2>
            <p class="game-description">Watch the multiplier grow and cash out before it crashes! Early crashes are common. Use auto-cashout to maximize your winnings!</p>
            
            <div class="game-content">
                <div class="input-group">
                    <label><i class="fas fa-coins"></i> Bet Amount:</label>
                    <input type="number" id="crashBet" placeholder="Enter bet" min="1" value="10">
                    <div class="bet-controls">
                        <button class="bet-btn" onclick="setBetAmount('crashBet', 10)">$10</button>
                        <button class="bet-btn" onclick="setBetAmount('crashBet', 100)">$100</button>
                        <button class="bet-btn" onclick="setBetAmount('crashBet', 1000)">$1K</button>
                        <button class="bet-btn" onclick="setBetAmount('crashBet', 10000)">$10K</button>
                    </div>
                </div>
                
                <div class="crash-auto">
                    <div class="auto-settings">
                        <div class="auto-setting">
                            <label for="autoCashout"><i class="fas fa-robot"></i> Auto Cashout</label>
                            <input type="number" id="autoCashout" placeholder="Multiplier" min="1.1" step="0.1" value="2.0">
                        </div>
                        <div class="auto-setting">
                            <label for="autoBetAmount"><i class="fas fa-coins"></i> Auto Bet Amount</label>
                            <input type="number" id="autoBetAmount" placeholder="Amount" min="1" value="10">
                        </div>
                        <div class="auto-setting">
                            <label for="autoBetCount"><i class="fas fa-redo"></i> Auto Bet Count</label>
                            <input type="number" id="autoBetCount" placeholder="Count" min="1" value="10">
                        </div>
                    </div>
                    <div class="bet-controls">
                        <button class="btn" onclick="startCrash()" id="crashStart">
                            <i class="fas fa-play"></i> Start Crash
                        </button>
                        <button class="btn btn-gold" onclick="cashoutCrash()" id="crashCashout" style="display:none;">
                            <i class="fas fa-hand-holding-usd"></i> Cash Out
                        </button>
                        <button class="btn btn-info" onclick="startAutoCrash()" id="autoCrashBtn">
                            <i class="fas fa-robot"></i> Auto Bet
                        </button>
                    </div>
                </div>
                
                <div class="crash-game">
                    <div class="crash-multiplier" id="crashMultiplier">1.00x</div>
                    <div class="crash-history" id="crashHistory"></div>
                </div>
                
                <div id="crashResult" class="game-result"></div>
            </div>
        </div>

        <!-- Bonus Tab -->
        <div class="game-tab" id="bonus-tab">
            <h2 class="game-title"><i class="fas fa-gift"></i> Bonus Games</h2>
            <p class="game-description">Special bonus games that unlock as you play! Spin the wheel for a chance to win big prizes, or collect daily rewards!</p>
            
            <div class="game-content">
                <div class="bonus-wheel">
                    <div class="wheel-pointer"></div>
                    <div class="wheel-spin" id="wheelSpin" data-rotation="0" style="background: conic-gradient(from -25.7143deg, rgb(255, 94, 87) 0deg, rgb(255, 94, 87) 51.4286deg, rgb(255, 137, 6) 51.4286deg, rgb(255, 137, 6) 102.857deg, rgb(255, 215, 0) 102.857deg, rgb(255, 215, 0) 154.286deg, rgb(46, 204, 113) 154.286deg, rgb(46, 204, 113) 205.714deg, rgb(52, 152, 219) 205.714deg, rgb(52, 152, 219) 257.143deg, rgb(155, 89, 182) 257.143deg, rgb(155, 89, 182) 308.571deg, rgb(231, 76, 60) 308.571deg, rgb(231, 76, 60) 360deg); transform: rotate(0deg);">
                        <div class="wheel-labels" id="wheelLabels"><div class="wheel-label" style="transform: translate(-50%, -50%) rotate(25.7143deg);"><span style="transform: rotate(-25.7143deg) translate(-50%, -114px); font-size: 18px;">$100</span></div><div class="wheel-label" style="transform: translate(-50%, -50%) rotate(77.1429deg);"><span style="transform: rotate(-77.1429deg) translate(-50%, -114px); font-size: 18px;">$200</span></div><div class="wheel-label" style="transform: translate(-50%, -50%) rotate(128.571deg);"><span style="transform: rotate(-128.571deg) translate(-50%, -114px); font-size: 18px;">$500</span></div><div class="wheel-label" style="transform: translate(-50%, -50%) rotate(180deg);"><span style="transform: rotate(-180deg) translate(-50%, -114px); font-size: 18px;">$1000</span></div><div class="wheel-label" style="transform: translate(-50%, -50%) rotate(231.429deg);"><span style="transform: rotate(-231.429deg) translate(-50%, -114px); font-size: 18px;">$2000</span></div><div class="wheel-label" style="transform: translate(-50%, -50%) rotate(282.857deg);"><span style="transform: rotate(-282.857deg) translate(-50%, -114px); font-size: 18px;">$5000</span></div><div class="wheel-label" style="transform: translate(-50%, -50%) rotate(334.286deg);"><span style="transform: rotate(-334.286deg) translate(-50%, -114px); font-size: 18px;">JACKPOT</span></div></div>
                    </div>
                    <div class="wheel-center" id="spinWheelBtn" onclick="spinWheel()">
                        SPIN
                    </div>
                </div>
                
                <div class="bet-controls">
                    <button class="btn btn-gold" onclick="spinWheel()" id="wheelSpinBtn"><i class="fas fa-gift"></i> Spin Wheel ($1000)</button>
                    <div class="countdown" id="nextFreeSpin" style="display: block;">Next free spin: 23h 47m</div>
                </div>
                
                <div id="wheelResult" class="game-result"></div>
                
                <div class="history-log" id="wheelHistory"><div class="history-entry spin">🎉 You won $200!</div><div class="history-entry spin">🎉 You won $200!</div><div class="history-entry daily">🎉 You won $200! (Free Spin)</div></div>
            </div>
        </div>

        <!-- Achievements Tab -->
        <div class="game-tab" id="achievements-tab">
            <h2 class="game-title"><i class="fas fa-trophy"></i> Achievements &amp; Rewards</h2>
            <p class="game-description">Complete challenges to earn bonus money and unlock special rewards! Some achievements unlock new games and features!</p>
            
            <div class="game-content">
                <div class="achievements-grid" id="achievementsGrid"><div class="achievement-card ">
                    <div class="achievement-icon">💼</div>
                    <div class="achievement-name">Stake Starter</div>
                    <div class="achievement-description">Secure your first stake loan</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 100</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">💰</div>
                    <div class="achievement-name">Millionaire</div>
                    <div class="achievement-description">Reach $1,000,000</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 50,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">💎</div>
                    <div class="achievement-name">Billionaire</div>
                    <div class="achievement-description">Reach $1,000,000,000</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 500,000,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">👑</div>
                    <div class="achievement-name">100T Titan</div>
                    <div class="achievement-description">Stack $100,000,000,000,000 and outlast the house</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: VICTORY!</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">🎰</div>
                    <div class="achievement-name">High Roller</div>
                    <div class="achievement-description">Bet $100,000 in a single game</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 1%"></div>
                        </div>
                        <div>1% complete</div>
                    
                    <div class="achievement-reward">Reward: 25,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">🎲</div>
                    <div class="achievement-name">Gambling Addict</div>
                    <div class="achievement-description">Play 100 games</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 5%"></div>
                        </div>
                        <div>5% complete</div>
                    
                    <div class="achievement-reward">Reward: 10,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">💣</div>
                    <div class="achievement-name">Mine Expert</div>
                    <div class="achievement-description">Successfully cash out from mines 10 times</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 5,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">🚀</div>
                    <div class="achievement-name">Crash Survivor</div>
                    <div class="achievement-description">Cash out at 10x multiplier or higher</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 15,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">🍀</div>
                    <div class="achievement-name">Lucky Streak</div>
                    <div class="achievement-description">Win 5 games in a row</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 20%"></div>
                        </div>
                        <div>20% complete</div>
                    
                    <div class="achievement-reward">Reward: 7,500</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">🎊</div>
                    <div class="achievement-name">Big Winner</div>
                    <div class="achievement-description">Win $500,000 total across all games</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 100,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">🃏</div>
                    <div class="achievement-name">Blackjack Master</div>
                    <div class="achievement-description">Win 50 blackjack games</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 20,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">🎰</div>
                    <div class="achievement-name">Slot King</div>
                    <div class="achievement-description">Hit 3 jackpots on slots</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 30,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">⚡</div>
                    <div class="achievement-name">Power Player</div>
                    <div class="achievement-description">Unlock all power-ups in Mines</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div>0% complete</div>
                    
                    <div class="achievement-reward">Reward: 15,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div><div class="achievement-card ">
                    <div class="achievement-icon">📅</div>
                    <div class="achievement-name">Daily Player</div>
                    <div class="achievement-description">Collect 7 daily bonuses</div>
                    
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: 14%"></div>
                        </div>
                        <div>14% complete</div>
                    
                    <div class="achievement-reward">Reward: 5,000</div>
                    <div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>
                </div></div>
            </div>
        </div>

        <!-- Referral Tab -->
        <div class="game-tab active" id="referral-tab">
            <h2 class="game-title"><i class="fas fa-users"></i> Referral &amp; Social Rewards</h2>
            <p class="game-description">Share CASINO EMPIRE, pick up instant bonuses, and pocket 10% of every friend’s winnings without touching their chips.</p>

            <div class="game-content">
                <div class="referral-link-box">
                    <code id="referralLink">file:///Users/roqate/Downloads/HomeAlarm/aaa.html?ref=ref-8MQS6B</code>
                    <button class="btn btn-info" onclick="copyReferralLink()"><i class="fas fa-copy"></i> Copy</button>
                    <button class="btn btn-success" onclick="openReferralLink()"><i class="fas fa-link"></i> Open</button>
                </div>

                <div class="share-grid" id="shareGrid">
                    <div class="share-card" data-action="instagram">
                        <h3><i class="fab fa-instagram"></i> Instagram</h3>
                        <p>Flex your latest jackpot or comeback story on Instagram.</p>
                        <button class="btn" data-label="Share on Instagram" onclick="completeShareAction('instagram')">Share on Instagram (+$5,000)</button>
                    </div>
                    <div class="share-card completed" data-action="facebook">
                        <h3><i class="fab fa-facebook"></i> Facebook</h3>
                        <p>Let your Facebook crew know the house can’t stop you.</p>
                        <button class="btn" data-label="Post to Facebook" onclick="completeShareAction('facebook')" disabled="">Completed</button>
                    </div>
                    <div class="share-card" data-action="x">
                        <h3><i class="fab fa-x-twitter"></i> X</h3>
                        <p>Drop a hot take on X about your wildest Casino Empire moment.</p>
                        <button class="btn" data-label="Post on X" onclick="completeShareAction('x')">Post on X (+$5,000)</button>
                    </div>
                    <div class="share-card" data-action="friend">
                        <h3><i class="fas fa-user-friends"></i> Share with a Friend</h3>
                        <p>DM your invite link and pull them into the grind.</p>
                        <button class="btn" data-label="Share Link" onclick="completeShareAction('friend')">Share Link (+$10,000)</button>
                    </div>
                </div>

                <div class="referral-summary">
                    <div class="summary-card">
                        <div class="label">Total Referral Earnings</div>
                        <div class="value" id="referralEarningsValue">$0</div>
                    </div>
                    <div class="summary-card">
                        <div class="label">Active Referrals</div>
                        <div class="value" id="referralCountValue">0</div>
                    </div>
                    <div class="summary-card">
                        <div class="label">Share Bonuses</div>
                        <div class="value" id="shareBonusValue">$5,000</div>
                    </div>
                    <div class="summary-card">
                        <div class="label">Link Clicks</div>
                        <div class="value" id="referralClicksValue">0</div>
                    </div>
                </div>

                <table class="referral-table" id="referralTable" style="display:none;">
                    <thead>
                        <tr>
                            <th>Friend</th>
                            <th>Joined</th>
                            <th>Your Cut</th>
                        </tr>
                    </thead>
                    <tbody id="referralTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Leaderboard Tab -->
        <div class="game-tab" id="leaderboard-tab">
            <h2 class="game-title"><i class="fas fa-crown"></i> Global Leaderboard</h2>
            <p class="game-description">Top rollers on this device. Resetting wipes your legacy, so cash out or go bust with style.</p>

            <div class="game-content">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Player</th>
                            <th>Balance</th>
                            <th>Total Won</th>
                            <th>Referral Rewards</th>
                            <th>Last Active</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody"><tr class="highlight">
                    <td>1</td>
                    <td>ininin</td>
                    <td>$3,650</td>
                    <td>$700</td>
                    <td>$0</td>
                    <td>9/22/2025, 9:58:28 PM</td>
                </tr><tr>
                    <td>2</td>
                    <td>aaa</td>
                    <td>$200</td>
                    <td>$200</td>
                    <td>$0</td>
                    <td>9/22/2025, 9:39:19 PM</td>
                </tr></tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        const SESSION_SECRET = 'casino-empire-shhh';

        function generateSessionToken() {
            return Array.from({ length: 4 }, () => Math.random().toString(36).slice(2)).join('').slice(0, 32);
        }

        function createDefaultGameData() {
            return {
                balance: 1000,
                totalWagered: 0,
                totalWon: 0,
                gamesPlayed: 0,
                achievements: {},
                session: {
                    token: generateSessionToken(),
                    signature: ''
                },
                profile: {
                    username: '',
                    profileId: '',
                    termsAccepted: false,
                    referralCode: '',
                    referredBy: null
                },
                referral: {
                    shareProgress: { instagram: false, facebook: false, x: false, friend: false },
                    shareRewardsClaimed: 0,
                    totalReferralEarnings: 0,
                    creditedToReferrer: 0,
                    referredUsers: [],
                    clickCount: 0,
                    relationshipRegistered: false
                },
                loan: {
                    principal: 0,
                    outstanding: 0,
                    lastTakenAt: 0,
                    dueAt: 0,
                    nextInterestTick: 0,
                    warningIssued: false,
                    overdue: false,
                    autoForfeitAt: 0
                },
                stats: {
                    blackjack: { wins: 0, losses: 0, pushes: 0, profit: 0, streak: 0, maxStreak: 0 },
                    coinflip: { wins: 0, losses: 0, profit: 0, streak: 0, maxStreak: 0 },
                    slots: { wins: 0, losses: 0, profit: 0, jackpots: 0, spins: 0 },
                    mines: { wins: 0, losses: 0, profit: 0, minesHit: 0, highestCashout: 0 },
                    crash: { wins: 0, losses: 0, profit: 0, highestMultiplier: 0 },
                    roulette: { wins: 0, losses: 0, profit: 0, maxPayout: 0, streak: 0, maxStreak: 0 },
                    loan: { borrowed: 0, repaid: 0, penalties: 0 }
                },
                gameStates: {
                    minesActive: false,
                    minesBet: 0,
                    minesRevealed: 0,
                    minesCount: 3,
                    minesGrid: [],
                    minesPowerups: { reveal: 0, shield: 0 },
                    crashActive: false,
                    crashBet: 0,
                    crashMultiplier: 1.0,
                    crashHistory: [],
                    crashPlayerOut: false,
                    crashAuto: { active: false, cashout: 2.0, amount: 10, count: 10, remaining: 0, queueNext: false },
                    blackjackActive: false,
                    blackjackBet: 0,
                    playerHand: [],
                    dealerHand: [],
                    gamePhase: 'betting',
                    coinFlipping: false,
                    coinStreak: { active: false, count: 0, bet: 0, choice: '', multiplier: 3 },
                    slotsSpinning: false,
                    slotsJackpot: 10000,
                    slotsBonusCounter: 0,
                    wheelSpinning: false,
                    lastFreeSpin: 0,
                    wheelPrizes: [
                        { value: 100, color: '#ff5e57', text: '$100' },
                        { value: 200, color: '#ff8906', text: '$200' },
                        { value: 500, color: '#ffd700', text: '$500' },
                        { value: 1000, color: '#2ecc71', text: '$1000' },
                        { value: 2000, color: '#3498db', text: '$2000' },
                        { value: 5000, color: '#9b59b6', text: '$5000' },
                        { value: 'JACKPOT', color: '#e74c3c', text: 'JACKPOT' }
                    ],
                    rouletteSpinning: false,
                    rouletteBet: 0,
                    rouletteChoice: null,
                    rouletteRecentNumbers: []
                },
                gameHistory: {
                    loan: [],
                    blackjack: [],
                    coinflip: [],
                    slots: [],
                    mines: [],
                    crash: [],
                    roulette: [],
                    wheel: []
                }
            };
        }

        let gameData = createDefaultGameData();

        function base64Encode(str) {
            return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (_, p1) => String.fromCharCode(parseInt(p1, 16))));
        }

        function computeSignature(data) {
            if (!data.session || !data.session.token) {
                data.session = { token: generateSessionToken(), signature: '' };
            }

            const payload = [
                data.balance,
                data.totalWagered,
                data.totalWon,
                data.gamesPlayed,
                JSON.stringify(data.profile),
                JSON.stringify(data.stats),
                JSON.stringify(data.loan)
            ].join('|');

            return base64Encode(`${data.session.token}|${payload}|${SESSION_SECRET}`);
        }

        function mergeGameData(parsed) {
            const defaults = createDefaultGameData();
            const merged = { ...defaults, ...parsed };

            merged.session = { ...defaults.session, ...(parsed.session || {}) };
            merged.profile = { ...defaults.profile, ...(parsed.profile || {}) };
            merged.referral = { ...defaults.referral, ...(parsed.referral || {}) };
            merged.referral.shareProgress = { ...defaults.referral.shareProgress, ...(((parsed.referral || {}).shareProgress) || {}) };
            merged.loan = { ...defaults.loan, ...(parsed.loan || {}) };

            merged.stats = {};
            Object.keys(defaults.stats).forEach(key => {
                merged.stats[key] = { ...defaults.stats[key], ...((parsed.stats && parsed.stats[key]) || {}) };
            });

            merged.gameStates = { ...defaults.gameStates, ...(parsed.gameStates || {}) };
            merged.gameStates.crashAuto = { ...defaults.gameStates.crashAuto, ...((parsed.gameStates && parsed.gameStates.crashAuto) || {}) };
            merged.gameStates.coinStreak = { ...defaults.gameStates.coinStreak, ...((parsed.gameStates && parsed.gameStates.coinStreak) || {}) };
            merged.gameStates.wheelPrizes = (parsed.gameStates && parsed.gameStates.wheelPrizes) ? parsed.gameStates.wheelPrizes : defaults.gameStates.wheelPrizes;
            if (typeof merged.gameStates.crashPlayerOut !== 'boolean') {
                merged.gameStates.crashPlayerOut = false;
            }
            if (!Array.isArray(merged.gameStates.rouletteRecentNumbers)) {
                merged.gameStates.rouletteRecentNumbers = [];
            }

            merged.gameHistory = { ...defaults.gameHistory, ...(parsed.gameHistory || {}) };
            if (parsed.gameHistory && parsed.gameHistory.beg) {
                merged.gameHistory.loan = parsed.gameHistory.loan && parsed.gameHistory.loan.length ? parsed.gameHistory.loan : parsed.gameHistory.beg;
            }
            delete merged.gameHistory.beg;

            Object.keys(defaults.gameHistory).forEach(key => {
                if (!Array.isArray(merged.gameHistory[key])) {
                    merged.gameHistory[key] = [];
                }
            });

            merged.achievements = { ...(parsed.achievements || {}) };
            if (parsed.achievements && parsed.achievements.firstBeg && !merged.achievements.stakeStarter) {
                merged.achievements.stakeStarter = parsed.achievements.firstBeg;
            }

            return merged;
        }

        function ensureSessionIntegrity() {
            if (!gameData.session || !gameData.session.token) {
                gameData.session = { token: generateSessionToken(), signature: '' };
                return true;
            }

            const expected = computeSignature(gameData);
            if (!gameData.session.signature) {
                gameData.session.signature = expected;
                return true;
            }

            return gameData.session.signature === expected;
        }

        function ensureProfileIdentifiers() {
            if (!gameData.profile) {
                gameData.profile = { username: '', profileId: '', termsAccepted: false, referralCode: '', referredBy: null };
            }

            if (!gameData.profile.profileId) {
                gameData.profile.profileId = 'pid_' + Math.random().toString(36).slice(2, 10) + Date.now().toString(36);
            }

            if (!gameData.profile.referralCode) {
                gameData.profile.referralCode = generateReferralCode();
            }
        }

        function generateReferralCode() {
            return 'ref-' + Math.random().toString(36).slice(2, 8).toUpperCase();
        }

        function applyReferralContext() {
            ensureProfileIdentifiers();
            const params = new URLSearchParams(window.location.search);
            const refCode = params.get('ref');
            if (refCode) {
                processReferralClick(refCode);
            }
            syncReferralIndex();
            syncReferralDataFromLeaderboard();
            collectPendingReferralRewards();
            updateReferralUI();
            renderLeaderboard();
        }

        function processReferralClick(refCode) {
            const index = loadReferralIndex();
            const refData = index[refCode];
            if (!refData) {
                return;
            }
            if (refData.profileId === gameData.profile.profileId) {
                return;
            }
            if (!gameData.profile.referredBy) {
                gameData.profile.referredBy = { profileId: refData.profileId, username: refData.username };
            }

            const leaderboard = loadLeaderboardData();
            let refEntry = leaderboard.find(entry => entry.profileId === refData.profileId);
            if (!refEntry) {
                refEntry = {
                    profileId: refData.profileId,
                    username: refData.username || 'Player',
                    referralCode: refCode,
                    balance: 0,
                    totalWon: 0,
                    referralRewards: 0,
                    shareRewards: 0,
                    pendingRewards: 0,
                    referredUsers: [],
                    clicks: 0,
                    updatedAt: Date.now()
                };
                leaderboard.push(refEntry);
            }
            refEntry.clicks = (refEntry.clicks || 0) + 1;
            refEntry.updatedAt = Date.now();
            saveLeaderboardData(leaderboard);
        }

        function syncReferralIndex() {
            ensureProfileIdentifiers();
            const index = loadReferralIndex();
            index[gameData.profile.referralCode] = {
                profileId: gameData.profile.profileId,
                username: gameData.profile.username || 'Unknown'
            };
            saveReferralIndex(index);
        }

        function collectPendingReferralRewards() {
            ensureProfileIdentifiers();
            const pending = loadPendingRewards();
            const entry = pending[gameData.profile.profileId];
            if (entry && entry.amount > 0) {
                const amount = entry.amount;
                gameData.balance += amount;
                gameData.referral.totalReferralEarnings += amount;
                showNotification(`Referral bonus collected: +$${amount.toLocaleString()}`, 'success');
                delete pending[gameData.profile.profileId];
                savePendingRewards(pending);
                const leaderboard = loadLeaderboardData();
                const lbEntry = leaderboard.find(item => item.profileId === gameData.profile.profileId);
                if (lbEntry) {
                    lbEntry.pendingRewards = Math.max((lbEntry.pendingRewards || 0) - amount, 0);
                    saveLeaderboardData(leaderboard);
                }
                updateBalance();
                syncReferralDataFromLeaderboard();
                renderLeaderboard();
            }
        }

        function registerReferralRelationship() {
            if (!gameData.profile || !gameData.profile.referredBy || gameData.referral.relationshipRegistered || !gameData.profile.username) {
                return;
            }

            const refInfo = gameData.profile.referredBy;
            const leaderboard = loadLeaderboardData();
            let refEntry = leaderboard.find(entry => entry.profileId === refInfo.profileId);
            if (!refEntry) {
                refEntry = {
                    profileId: refInfo.profileId,
                    username: refInfo.username,
                    referralCode: '',
                    balance: 0,
                    totalWon: 0,
                    referralRewards: 0,
                    shareRewards: 0,
                    pendingRewards: 0,
                    clicks: 0,
                    referredUsers: [],
                    updatedAt: Date.now()
                };
                leaderboard.push(refEntry);
            }

            if (!Array.isArray(refEntry.referredUsers)) {
                refEntry.referredUsers = [];
            }

            refEntry.username = refInfo.username || refEntry.username;

            const exists = refEntry.referredUsers.some(user => user.profileId === gameData.profile.profileId);
            if (!exists) {
                refEntry.referredUsers.push({
                    profileId: gameData.profile.profileId,
                    username: gameData.profile.username || 'Pending',
                    joinedAt: Date.now(),
                    contributed: 0
                });
            }

            saveLeaderboardData(leaderboard);
            renderLeaderboard();

            gameData.referral.relationshipRegistered = true;
        }

        function syncReferralDataFromLeaderboard() {
            const leaderboard = loadLeaderboardData();
            const entry = leaderboard.find(item => item.profileId === (gameData.profile && gameData.profile.profileId));
            if (!entry) return;

            if (!gameData.referral) {
                gameData.referral = { shareProgress: { instagram: false, facebook: false, x: false, friend: false }, shareRewardsClaimed: 0, totalReferralEarnings: 0, creditedToReferrer: 0, referredUsers: [], clickCount: 0, relationshipRegistered: false };
            }

            if (Array.isArray(entry.referredUsers)) {
                gameData.referral.referredUsers = entry.referredUsers;
            }
            if (typeof entry.referralRewards === 'number') {
                gameData.referral.totalReferralEarnings = Math.max(gameData.referral.totalReferralEarnings || 0, entry.referralRewards);
            }
            if (typeof entry.clicks === 'number') {
                gameData.referral.clickCount = entry.clicks;
            }
        }

        function processReferralRewards() {
            ensureProfileIdentifiers();
            registerReferralRelationship();
            if (!gameData.referral) return;

            if (gameData.profile.referredBy) {
                const targetShare = Math.floor((gameData.totalWon || 0) * 0.1);
                const credited = gameData.referral.creditedToReferrer || 0;
                const delta = targetShare - credited;
                if (delta > 0) {
                    gameData.referral.creditedToReferrer = targetShare;
                    queueReferralReward(gameData.profile.referredBy.profileId, delta, gameData.profile.username, gameData.profile.referredBy.username);
                }
            }
        }

        function queueReferralReward(profileId, amount, referredUsername, referrerName = 'Player') {
            if (!profileId || amount <= 0) return;

            const pending = loadPendingRewards();
            pending[profileId] = {
                amount: (pending[profileId]?.amount || 0) + amount
            };
            savePendingRewards(pending);

            const leaderboard = loadLeaderboardData();
            let refEntry = leaderboard.find(entry => entry.profileId === profileId);
            if (!refEntry) {
                refEntry = {
                    profileId,
                    username: referrerName || 'Player',
                    referralCode: '',
                    balance: 0,
                    totalWon: 0,
                    referralRewards: 0,
                    shareRewards: 0,
                    pendingRewards: 0,
                    referredUsers: [],
                    updatedAt: Date.now()
                };
                leaderboard.push(refEntry);
            }

            refEntry.username = referrerName || refEntry.username;
            refEntry.referralRewards = (refEntry.referralRewards || 0) + amount;
            refEntry.pendingRewards = (refEntry.pendingRewards || 0) + amount;
            refEntry.updatedAt = Date.now();

            if (!Array.isArray(refEntry.referredUsers)) {
                refEntry.referredUsers = [];
            }

            const currentProfileId = gameData.profile && gameData.profile.profileId;
            const existing = refEntry.referredUsers.find(user => user.profileId === currentProfileId);
            if (existing) {
                existing.contributed = (existing.contributed || 0) + amount;
                existing.username = referredUsername || existing.username;
            } else if (currentProfileId) {
                refEntry.referredUsers.push({
                    profileId: currentProfileId,
                    username: referredUsername || 'Friend',
                    joinedAt: Date.now(),
                    contributed: amount
                });
            }

            saveLeaderboardData(leaderboard);

            if (profileId === gameData.profile.profileId) {
                collectPendingReferralRewards();
                syncReferralDataFromLeaderboard();
            }

            renderLeaderboard();
        }

        function removeProfileFromGlobalStores() {
            ensureProfileIdentifiers();
            const profileId = gameData.profile && gameData.profile.profileId;
            if (!profileId) return;

            const leaderboard = loadLeaderboardData()
                .map(entry => {
                    if (Array.isArray(entry.referredUsers)) {
                        entry.referredUsers = entry.referredUsers.filter(user => user.profileId !== profileId);
                    }
                    return entry;
                })
                .filter(entry => entry.profileId !== profileId);
            saveLeaderboardData(leaderboard);

            const index = loadReferralIndex();
            Object.keys(index).forEach(code => {
                if (index[code].profileId === profileId) {
                    delete index[code];
                }
            });
            saveReferralIndex(index);

            const pending = loadPendingRewards();
            if (pending[profileId]) {
                delete pending[profileId];
                savePendingRewards(pending);
            }
        }

        function updateLeaderboardEntry() {
            ensureProfileIdentifiers();
            const leaderboard = loadLeaderboardData();
            let entry = leaderboard.find(item => item.profileId === gameData.profile.profileId);
            if (!entry) {
                entry = {
                    profileId: gameData.profile.profileId,
                    username: gameData.profile.username || 'Player',
                    referralCode: gameData.profile.referralCode,
                    balance: 0,
                    totalWon: 0,
                    referralRewards: gameData.referral.totalReferralEarnings || 0,
                    shareRewards: gameData.referral.shareRewardsClaimed || 0,
                    pendingRewards: 0,
                    referredUsers: gameData.referral.referredUsers || [],
                    clicks: gameData.referral.clickCount || 0,
                    referredBy: gameData.profile.referredBy || null,
                    updatedAt: Date.now()
                };
                leaderboard.push(entry);
            }

            entry.username = gameData.profile.username || entry.username;
            entry.referralCode = gameData.profile.referralCode;
            entry.balance = gameData.balance;
            entry.totalWon = gameData.totalWon;
            entry.referralRewards = gameData.referral.totalReferralEarnings || entry.referralRewards || 0;
            entry.shareRewards = gameData.referral.shareRewardsClaimed || entry.shareRewards || 0;
            entry.pendingRewards = entry.pendingRewards || 0;
            entry.referredBy = gameData.profile.referredBy || entry.referredBy || null;
             entry.clicks = gameData.referral.clickCount || entry.clicks || 0;
            entry.updatedAt = Date.now();

            if (Array.isArray(gameData.referral.referredUsers)) {
                entry.referredUsers = gameData.referral.referredUsers;
            }

            saveLeaderboardData(leaderboard);
            renderLeaderboard();
        }

        function renderLeaderboard() {
            const tbody = document.getElementById('leaderboardBody');
            if (!tbody) return;

            const leaderboard = loadLeaderboardData()
                .sort((a, b) => (b.balance || 0) - (a.balance || 0));

            if (leaderboard.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:20px;">No legends yet. Share your link and dominate the charts.</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            leaderboard.forEach((entry, idx) => {
                const row = document.createElement('tr');
                if (entry.profileId === (gameData.profile && gameData.profile.profileId)) {
                    row.classList.add('highlight');
                }
                row.innerHTML = `
                    <td>${idx + 1}</td>
                    <td>${entry.username || 'Player'}</td>
                    <td>$${(entry.balance || 0).toLocaleString()}</td>
                    <td>$${(entry.totalWon || 0).toLocaleString()}</td>
                    <td>$${(entry.referralRewards || 0).toLocaleString()}</td>
                    <td>${entry.updatedAt ? new Date(entry.updatedAt).toLocaleString() : '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function getReferralLink() {
            ensureProfileIdentifiers();
            const url = new URL(window.location.href.split('#')[0]);
            url.searchParams.set('ref', gameData.profile.referralCode);
            return url.origin + url.pathname + '?ref=' + gameData.profile.referralCode;
        }

        function updateReferralUI() {
            ensureProfileIdentifiers();
            if (!gameData.referral) return;
            const linkEl = document.getElementById('referralLink');
            if (linkEl) {
                linkEl.textContent = getReferralLink();
            }

            const earningsEl = document.getElementById('referralEarningsValue');
            const countEl = document.getElementById('referralCountValue');
            const shareEl = document.getElementById('shareBonusValue');
            const clicksEl = document.getElementById('referralClicksValue');

            if (earningsEl) earningsEl.textContent = '$' + (gameData.referral.totalReferralEarnings || 0).toLocaleString();
            if (countEl) countEl.textContent = (gameData.referral.referredUsers || []).length;
            if (shareEl) shareEl.textContent = '$' + (gameData.referral.shareRewardsClaimed || 0).toLocaleString();
            if (clicksEl) clicksEl.textContent = (gameData.referral.clickCount || 0);

            document.querySelectorAll('.share-card').forEach(card => {
                const action = card.getAttribute('data-action');
                const done = gameData.referral.shareProgress && gameData.referral.shareProgress[action];
                const button = card.querySelector('button');
                if (done) {
                    card.classList.add('completed');
                    if (button) {
                        button.textContent = 'Completed';
                        button.disabled = true;
                    }
                } else {
                    card.classList.remove('completed');
                    if (button) {
                        const reward = SHARE_REWARD_VALUES[action] || 0;
                        const base = button.getAttribute('data-label') || button.textContent.split('(')[0].trim();
                        button.textContent = `${base} (+$${reward.toLocaleString()})`;
                        button.disabled = false;
                    }
                }
            });

            const table = document.getElementById('referralTable');
            const tbody = document.getElementById('referralTableBody');
            if (table && tbody) {
                const list = gameData.referral.referredUsers || [];
                if (list.length === 0) {
                    table.style.display = 'none';
                    tbody.innerHTML = '';
                } else {
                    table.style.display = 'table';
                    tbody.innerHTML = '';
                    list.forEach(user => {
                        const row = document.createElement('tr');
                        const earned = user.contributed || 0;
                        row.innerHTML = `
                            <td>${user.username || 'Friend'}</td>
                            <td>${user.joinedAt ? new Date(user.joinedAt).toLocaleString() : '-'}</td>
                            <td>$${earned.toLocaleString()}</td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            }
        }

        function completeShareAction(action) {
            ensureProfileIdentifiers();
            if (!SHARE_REWARD_VALUES[action]) {
                return;
            }
            if (!gameData.referral.shareProgress[action]) {
                gameData.referral.shareProgress[action] = true;
                const reward = SHARE_REWARD_VALUES[action];
                gameData.balance += reward;
                gameData.referral.shareRewardsClaimed += reward;
                updateBalance();
                showNotification(`Share bonus unlocked! +$${reward.toLocaleString()}`, 'success');
                updateReferralUI();
                saveGameData();
            } else {
                showNotification('You already claimed this share bonus.', 'info');
            }

            const shareUrls = {
                instagram: 'https://www.instagram.com/',
                facebook: 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(getReferralLink()),
                x: 'https://twitter.com/intent/tweet?url=' + encodeURIComponent(getReferralLink()) + '&text=Join%20me%20at%20CASINO%20EMPIRE!',
                friend: getReferralLink()
            };

            const target = shareUrls[action];
            if (target) {
                window.open(target, '_blank');
            }
        }

        function copyReferralLink() {
            const link = getReferralLink();
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(link).then(() => {
                    showNotification('Referral link copied to clipboard!', 'success');
                }).catch(() => fallbackCopyLink(link));
            } else {
                fallbackCopyLink(link);
            }
        }

        function fallbackCopyLink(link) {
            const temp = document.createElement('textarea');
            temp.value = link;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand('copy');
            document.body.removeChild(temp);
            showNotification('Referral link copied to clipboard!', 'success');
        }

        function openReferralLink() {
            window.open(getReferralLink(), '_blank');
        }

        function isUsernameAvailable(username, profileId) {
            const leaderboard = loadLeaderboardData();
            const lower = username.toLowerCase();
            return !leaderboard.some(entry => entry.username && entry.username.toLowerCase() === lower && entry.profileId !== profileId);
        }

        function checkTermsAcceptance() {
            const overlay = document.getElementById('termsOverlay');
            const input = document.getElementById('playerUsername');

            if (!overlay) return;

            if (!gameData.profile) {
                gameData.profile = { username: '', termsAccepted: false };
            }

            const accepted = !!gameData.profile.termsAccepted;

            if (accepted) {
                overlay.classList.remove('active');
                document.body.classList.remove('terms-locked');
                if (input) {
                    input.value = gameData.profile.username || '';
                }
            } else {
                overlay.classList.add('active');
                document.body.classList.add('terms-locked');
                if (input) {
                    input.value = (gameData.profile && gameData.profile.username) || '';
                    setTimeout(() => input.focus(), 150);
                }
            }
        }

        function acceptTerms() {
            const input = document.getElementById('playerUsername');
            if (!input) return;

            const rawName = input.value.trim();
            if (rawName.length < 3) {
                showNotification('Username must be at least 3 characters.', 'error');
                return;
            }

            if (!/^[a-zA-Z0-9 _-]+$/.test(rawName)) {
                showNotification('Use letters, numbers, spaces, hyphen, or underscore only.', 'error');
                return;
            }

            const username = rawName.replace(/\s+/g, ' ');

            if (!gameData.profile) {
                gameData.profile = { username: '', profileId: '', termsAccepted: false, referralCode: '', referredBy: null };
            }

            ensureProfileIdentifiers();

            if (!isUsernameAvailable(username, gameData.profile.profileId)) {
                showNotification('That username is already taken. Choose something unique.', 'error');
                return;
            }

            gameData.profile.username = username;
            gameData.profile.termsAccepted = true;

            registerReferralRelationship();
            updateLeaderboardEntry();
            updateReferralUI();
            saveGameData();
            updateBalance();
            checkTermsAcceptance();
            showNotification(`Welcome, ${username}!`, 'success');
            renderLeaderboard();
        }

        const achievements = {
            stakeStarter: {
                name: "Stake Starter",
                description: "Secure your first stake loan",
                icon: "💼",
                reward: 100,
                condition: () => gameData.gameHistory.loan.length > 0,
                progress: () => gameData.gameHistory.loan.length > 0 ? 1 : 0,
                target: 1
            },
            millionaire: {
                name: "Millionaire",
                description: "Reach $1,000,000",
                icon: "💰",
                reward: 50000,
                condition: () => gameData.balance >= 1000000,
                progress: () => Math.min(gameData.balance / 1000000, 1),
                target: 1000000
            },
            billionaire: {
                name: "Billionaire", 
                description: "Reach $1,000,000,000",
                icon: "💎",
                reward: 500000000,
                condition: () => gameData.balance >= 1000000000,
                progress: () => Math.min(gameData.balance / 1000000000, 1),
                target: 1000000000
            },
            trillionaire: {
                name: "100T Titan",
                description: "Stack $100,000,000,000,000 and outlast the house",
                icon: "👑",
                reward: 0,
                condition: () => gameData.balance >= 100000000000000,
                progress: () => Math.min(gameData.balance / 100000000000000, 1),
                target: 100000000000000
            },
            highRoller: {
                name: "High Roller",
                description: "Bet $100,000 in a single game",
                icon: "🎰",
                reward: 25000,
                condition: () => gameData.totalWagered >= 100000,
                progress: () => Math.min(gameData.totalWagered / 100000, 1),
                target: 100000
            },
            addicted: {
                name: "Gambling Addict",
                description: "Play 100 games",
                icon: "🎲",
                reward: 10000,
                condition: () => gameData.gamesPlayed >= 100,
                progress: () => Math.min(gameData.gamesPlayed / 100, 1),
                target: 100
            },
            mineExpert: {
                name: "Mine Expert", 
                description: "Successfully cash out from mines 10 times",
                icon: "💣",
                reward: 5000,
                condition: () => gameData.stats.mines.wins >= 10,
                progress: () => Math.min(gameData.stats.mines.wins / 10, 1),
                target: 10
            },
            crashSurvivor: {
                name: "Crash Survivor",
                description: "Cash out at 10x multiplier or higher",
                icon: "🚀", 
                reward: 15000,
                condition: () => gameData.stats.crash.highestMultiplier >= 10,
                progress: () => Math.min(gameData.stats.crash.highestMultiplier / 10, 1),
                target: 10
            },
            luckyStreak: {
                name: "Lucky Streak",
                description: "Win 5 games in a row",
                icon: "🍀",
                reward: 7500,
                condition: () => {
                    for (let game in gameData.stats) {
                        if (gameData.stats[game].streak >= 5) return true;
                    }
                    return false;
                },
                progress: () => {
                    let maxStreak = 0;
                    for (let game in gameData.stats) {
                        if (gameData.stats[game].streak > maxStreak) maxStreak = gameData.stats[game].streak;
                    }
                    return Math.min(maxStreak / 5, 1);
                },
                target: 5
            },
            bigWinner: {
                name: "Big Winner",
                description: "Win $500,000 total across all games",
                icon: "🎊",
                reward: 100000,
                condition: () => gameData.totalWon >= 500000,
                progress: () => Math.min(gameData.totalWon / 500000, 1),
                target: 500000
            },
            blackjackMaster: {
                name: "Blackjack Master",
                description: "Win 50 blackjack games",
                icon: "🃏",
                reward: 20000,
                condition: () => gameData.stats.blackjack.wins >= 50,
                progress: () => Math.min(gameData.stats.blackjack.wins / 50, 1),
                target: 50
            },
            slotKing: {
                name: "Slot King",
                description: "Hit 3 jackpots on slots",
                icon: "🎰",
                reward: 30000,
                condition: () => gameData.stats.slots.jackpots >= 3,
                progress: () => Math.min(gameData.stats.slots.jackpots / 3, 1),
                target: 3
            },
            powerPlayer: {
                name: "Power Player",
                description: "Unlock all power-ups in Mines",
                icon: "⚡",
                reward: 15000,
                condition: () => gameData.gameStates.minesPowerups.reveal > 0 && gameData.gameStates.minesPowerups.shield > 0,
                progress: () => (gameData.gameStates.minesPowerups.reveal > 0 ? 0.5 : 0) + (gameData.gameStates.minesPowerups.shield > 0 ? 0.5 : 0),
                target: 2
            },
            dailyPlayer: {
                name: "Daily Player",
                description: "Collect 7 daily bonuses",
                icon: "📅",
                reward: 5000,
                condition: () => gameData.gameHistory.wheel.filter(e => e.type === 'daily').length >= 7,
                progress: () => Math.min(gameData.gameHistory.wheel.filter(e => e.type === 'daily').length / 7, 1),
                target: 7
            }
        };

        const cardSuits = ['♥', '♦', '♠', '♣'];
        const cardValues = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

        const slotSymbols = ['🍒', '🍋', '🍊', '🍇', '🍉', '7️⃣', '🔔', '🍀', '⭐', '💎'];
        const slotPayouts = {
            '💎💎💎': 50,
            '⭐⭐⭐': 25,
            '🔔🔔🔔': 15,
            '🍀🍀🍀': 10,
            '7️⃣7️⃣7️⃣': 5,
            '🍒🍒🍒': 3,
            '🍋🍋🍋': 2,
            '🍊🍊🍊': 2,
            '🍇🍇🍇': 2,
            '🍉🍉🍉': 2,
            'any2': 1.5
        };

        const rouletteRedNumbers = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36]);
        const roulettePayouts = {
            red: 2,
            black: 2,
            even: 2,
            odd: 2,
            low: 2,
            high: 2,
            dozen1: 3,
            dozen2: 3,
            dozen3: 3,
            single: 36
        };
        const LEADERBOARD_KEY = 'casinoEmpireLeaderboard';
        const REFERRAL_INDEX_KEY = 'casinoEmpireReferralIndex';
        const REFERRAL_PENDING_KEY = 'casinoEmpireReferralPending';
        const SHARE_REWARD_VALUES = {
            instagram: 5000,
            facebook: 5000,
            x: 5000,
            friend: 10000
        };

        function loadLeaderboardData() {
            try {
                const stored = localStorage.getItem(LEADERBOARD_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    if (Array.isArray(parsed)) {
                        return parsed;
                    }
                }
            } catch (e) {
                console.error('Failed to load leaderboard data', e);
            }
            return [];
        }

        function saveLeaderboardData(data) {
            localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(data));
        }

        function loadReferralIndex() {
            try {
                const stored = localStorage.getItem(REFERRAL_INDEX_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    if (parsed && typeof parsed === 'object') {
                        return parsed;
                    }
                }
            } catch (e) {
                console.error('Failed to load referral index', e);
            }
            return {};
        }

        function saveReferralIndex(index) {
            localStorage.setItem(REFERRAL_INDEX_KEY, JSON.stringify(index));
        }

        function loadPendingRewards() {
            try {
                const stored = localStorage.getItem(REFERRAL_PENDING_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    if (parsed && typeof parsed === 'object') {
                        return parsed;
                    }
                }
            } catch (e) {
                console.error('Failed to load pending referral rewards', e);
            }
            return {};
        }

        function savePendingRewards(data) {
            localStorage.setItem(REFERRAL_PENDING_KEY, JSON.stringify(data));
        }

        function initGame() {
            const savedData = localStorage.getItem('casinoEmpireData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    gameData = mergeGameData(parsedData);
                } catch (e) {
                    console.error('Failed to load saved data:', e);
                    gameData = createDefaultGameData();
                }
            }

            if (!ensureSessionIntegrity()) {
                localStorage.removeItem('casinoEmpireData');
                gameData = createDefaultGameData();
                showNotification('Session data looked tampered. Progress reset to keep it fair.', 'warning');
            }

            updateBalance();
            updateStats();
            updateProgress();
            updateLoanUI();
            loadHistory();
            updateCrashHistory();
            renderAchievements();
            checkAchievements();
            initWheel();
            checkFreeSpin();
            updateJackpotDisplay();
            handleRouletteBetTypeChange();
            updateRouletteTicker();
            updateRouletteStats();
            ensureProfileIdentifiers();
            applyReferralContext();
            const savedTab = localStorage.getItem('casinoEmpireActiveTab') || 'loan';
            setActiveTab(savedTab, true);
            startLoanTicker();
            checkTermsAcceptance();

            saveGameData();
        }

        function saveGameData() {
            ensureProfileIdentifiers();
            processReferralRewards();
            gameData.session.signature = computeSignature(gameData);
            localStorage.setItem('casinoEmpireData', JSON.stringify(gameData));
            updateLeaderboardEntry();
            syncReferralIndex();
            updateReferralUI();
        }

        function resetGame() {
            if (confirm('Are you sure you want to reset ALL progress? This cannot be undone!')) {
                removeProfileFromGlobalStores();
                localStorage.removeItem('casinoEmpireData');
                localStorage.removeItem('casinoEmpireActiveTab');
                location.reload();
            }
        }

        function showHelp() {
            alert(`CASINO EMPIRE HELP:
            
💰 Balance: Your current bankroll
🎯 Progress: March toward $100,000,000,000,000

CORE SYSTEMS:
💼 Stake Loan: Borrow up to $100K every 10 minutes. Interest compounds every minute.
🃏 Blackjack: Beat the dealer to 21 (15% house edge)
🪙 Coinflip: 50/50 call with a sneaky house edge
🎰 Slots: Chase jackpots with risky reels
💎 Mines: Reveal gems and cash out before hitting bombs
🚀 Crash: Cash out before the multiplier implodes
🎁 Bonus: Daily free spins and rotating rewards

ACHIEVEMENTS:
Complete challenges to earn bonus bankroll and unlock bragging rights.

REMEMBER: This is a casino simulation. No real money is awarded or collected. Play for fun only!

            `);
        }

        function updateBalance() {
            document.getElementById('balance').textContent = gameData.balance.toLocaleString();
            document.getElementById('totalWagered').textContent = gameData.totalWagered.toLocaleString();
            document.getElementById('totalWon').textContent = gameData.totalWon.toLocaleString();
            document.getElementById('gamesPlayed').textContent = gameData.gamesPlayed.toLocaleString();
            const playerNameEl = document.getElementById('playerName');
            if (playerNameEl) {
                const username = (gameData.profile && gameData.profile.username) ? gameData.profile.username : 'Guest';
                playerNameEl.textContent = username || 'Guest';
            }
        }

        function updateStats() {
            const blackjackTotal = gameData.stats.blackjack.wins + gameData.stats.blackjack.losses + gameData.stats.blackjack.pushes;
            const blackjackWinRate = blackjackTotal > 0 ? Math.round((gameData.stats.blackjack.wins / blackjackTotal) * 100) : 0;
            document.getElementById('blackjackWinRate').textContent = blackjackWinRate + '%';
            document.getElementById('blackjackProfit').textContent = '$' + gameData.stats.blackjack.profit.toLocaleString();
            document.getElementById('blackjackStreak').textContent = gameData.stats.blackjack.streak;
            
            const minesTotal = gameData.stats.mines.wins + gameData.stats.mines.losses;
            const minesWinRate = minesTotal > 0 ? Math.round((gameData.stats.mines.wins / minesTotal) * 100) : 0;
            document.getElementById('minesWinRate').textContent = minesWinRate + '%';
            document.getElementById('minesProfit').textContent = '$' + gameData.stats.mines.profit.toLocaleString();
            document.getElementById('minesHit').textContent = gameData.stats.mines.minesHit;
            
            document.getElementById('jackpotAmount').textContent = gameData.gameStates.slotsJackpot.toLocaleString();
            document.getElementById('bonusSpins').textContent = 5 - (gameData.gameStates.slotsBonusCounter % 5);

            updateRouletteStats();
        }

        function updateProgress() {
            const target = 100000000000000; 
            const percent = Math.min((gameData.balance / target) * 100, 100);
            
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressPercent').textContent = percent.toFixed(6);
            document.getElementById('progressAmount').textContent = gameData.balance.toLocaleString();
            
            if (gameData.balance >= target && !gameData.achievements.trillionaire) {
                showAchievementPopup(achievements.trillionaire);
                gameData.achievements.trillionaire = true;
                showNotification('🎉 CONGRATULATIONS! YOU BEAT THE CASINO! 🎉', 'success');
                setTimeout(() => {
                    alert('🏆 GAME COMPLETED! 🏆\n\nYou have stacked $100,000,000,000,000 and outlived the pit bosses!\n\nFinal Balance: $' + gameData.balance.toLocaleString() + '\n\nYou are the ultimate gambling champion!');
                }, 2000);
            }
        }

        function showLoading(show = true) {
            document.getElementById('loadingOverlay').classList.toggle('active', show);
        }

        function validateBet(bet, minBet = 1) {
            if (isNaN(bet) || bet < minBet) {
                showNotification(`Minimum bet is ${minBet}!`, 'error');
                return false;
            }
            
            if (bet > gameData.balance) {
                showNotification('Insufficient balance!', 'error');
                return false;
            }
            
            return true;
        }

        function showResult(elementId, message, isWin = null) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'game-result';
            
            if (isWin === true) element.classList.add('win');
            else if (isWin === false) element.classList.add('lose');
            else element.classList.add('neutral');
        }

        function addToHistory(game, message, isWin = null, extraData = {}) {
            const { countGame = true, ...rest } = extraData;
            const entry = {
                timestamp: new Date().toLocaleString(),
                message: message,
                type: isWin === true ? 'win' : isWin === false ? 'lose' : 'neutral',
                ...rest
            };
            
            gameData.gameHistory[game].unshift(entry);
            if (gameData.gameHistory[game].length > 20) {
                gameData.gameHistory[game].pop();
            }
            
            updateHistoryDisplay(game);
            if (countGame) {
                gameData.gamesPlayed++;
            }
            
            if (countGame && game in gameData.stats && game !== 'loan') {
                if (isWin === true) {
                    gameData.stats[game].wins++;
                    gameData.stats[game].streak++;
                    if (gameData.stats[game].streak > gameData.stats[game].maxStreak) {
                        gameData.stats[game].maxStreak = gameData.stats[game].streak;
                    }
                } else if (isWin === false) {
                    gameData.stats[game].losses++;
                    gameData.stats[game].streak = 0;
                } else if (game === 'blackjack' && isWin === null) {
                    gameData.stats.blackjack.pushes++;
                    gameData.stats.blackjack.streak = 0;
                }
                
                updateStats();
            }
            
            saveGameData();
        }

        function updateHistoryDisplay(game) {
            const historyElement = document.getElementById(`${game}History`);
            if (!historyElement) return;
            
            historyElement.innerHTML = '';
            
            gameData.gameHistory[game].forEach(entry => {
                const entryElement = document.createElement('div');
                entryElement.className = `history-entry ${entry.type}`;
                entryElement.textContent = entry.message;
                historyElement.appendChild(entryElement);
            });
        }

        function loadHistory() {
            Object.keys(gameData.gameHistory).forEach(game => {
                updateHistoryDisplay(game);
            });
        }

        function setBetAmount(elementId, amount) {
            document.getElementById(elementId).value = amount;
        }

        function setLoanAmount(amount) {
            document.getElementById('loanAmount').value = amount;
        }

        let loanTickHandle = null;

        function requestLoan() {
            const now = Date.now();
            if (gameData.loan.outstanding > 0) {
                showNotification('You already have a stake outstanding. Repay or forfeit it first.', 'error');
                return;
            }

            const cooldownRemaining = (gameData.loan.lastTakenAt + 10 * 60 * 1000) - now;
            if (cooldownRemaining > 0) {
                showNotification(`Stake desk cooling down for ${formatDuration(cooldownRemaining)}.`, 'warning');
                return;
            }

            const amount = parseInt(document.getElementById('loanAmount').value);
            if (isNaN(amount) || amount < 1000 || amount > 100000) {
                showNotification('Stake amount must be between $1,000 and $100,000.', 'error');
                return;
            }

            animateButton(document.getElementById('loanRequestBtn'));

            gameData.loan.principal = amount;
            gameData.loan.outstanding = amount;
            gameData.loan.lastTakenAt = now;
            gameData.loan.dueAt = now + 60 * 60 * 1000;
            gameData.loan.nextInterestTick = now + 60 * 1000;
            gameData.loan.warningIssued = false;
            gameData.loan.overdue = false;
            gameData.loan.autoForfeitAt = gameData.loan.dueAt + 15 * 60 * 1000;

            gameData.stats.loan.borrowed += amount;
            gameData.balance += amount;

            updateBalance();
            updateProgress();
            updateLoanUI();

            const message = `💼 Stake approved for $${amount.toLocaleString()}. Repay within 1 hour.`;
            showResult('loanResult', message, true);
            addToHistory('loan', message, true, { countGame: false });
            showNotification(`Stake funded with $${amount.toLocaleString()}`, 'success');

            startLoanTicker();
            saveGameData();
        }

        function repayLoan() {
            if (gameData.loan.outstanding <= 0) {
                showNotification('No stake to repay.', 'info');
                return;
            }

            const payment = Math.ceil(gameData.loan.outstanding);
            if (gameData.balance < payment) {
                showNotification('You need more balance to repay this stake.', 'error');
                return;
            }

            animateButton(document.getElementById('loanRepayBtn'));

            gameData.balance -= payment;
            gameData.stats.loan.repaid += payment;

            const interestPaid = payment - gameData.loan.principal;
            const message = interestPaid > 0
                ? `✅ Repaid stake plus $${interestPaid.toLocaleString()} interest.`
                : '✅ Repaid stake with no interest.';

            showResult('loanResult', message, true);
            addToHistory('loan', message, true, { countGame: false });
            showNotification('Stake fully repaid. Back in good standing.', 'success');

            resetLoanState();
            updateBalance();
            updateProgress();
            updateLoanUI();
            saveGameData();
        }

        function forfeitLoan() {
            if (gameData.loan.outstanding <= 0) {
                showNotification('No active stake to forfeit.', 'info');
                return;
            }

            if (!confirm('Forfeiting triggers a severe penalty. Are you sure?')) {
                return;
            }

            applyLoanPenalty(2.0, '💀 Forfeited stake and paid $', 'Penalty collected for voluntary forfeit.');
        }

        function autoForfeitLoan() {
            if (gameData.loan.outstanding <= 0) return;
            applyLoanPenalty(2.5, '💀 Loan shark collected $', 'Stake default! The house seized your chips.');
        }

        function applyLoanPenalty(multiplier, historyPrefix, notificationMessage) {
            const penalty = Math.ceil(gameData.loan.outstanding * multiplier);
            const actualPenalty = Math.min(gameData.balance, penalty);
            gameData.balance -= actualPenalty;
            gameData.stats.loan.penalties += actualPenalty;

            const message = `${historyPrefix}${actualPenalty.toLocaleString()}.`;
            showResult('loanResult', message, false);
            addToHistory('loan', message, false, { countGame: false });
            showNotification(notificationMessage, 'error');

            resetLoanState();
            updateBalance();
            updateProgress();
            updateLoanUI();
            saveGameData();
        }

        function resetLoanState() {
            gameData.loan.lastTakenAt = Date.now();
            gameData.loan.principal = 0;
            gameData.loan.outstanding = 0;
            gameData.loan.dueAt = 0;
            gameData.loan.nextInterestTick = 0;
            gameData.loan.warningIssued = false;
            gameData.loan.overdue = false;
            gameData.loan.autoForfeitAt = 0;
            document.getElementById('loanWarning').textContent = '';
            startLoanTicker();
        }

        function applyLoanInterest() {
            if (gameData.loan.outstanding <= 0) return;

            const now = Date.now();
            const overdue = now > gameData.loan.dueAt;
            const rate = overdue ? 0.25 : 0.12;
            gameData.loan.outstanding = Math.ceil(gameData.loan.outstanding * (1 + rate));
            gameData.loan.nextInterestTick = now + 60 * 1000;
            gameData.loan.overdue = overdue;

            const message = overdue
                ? `🔥 Overdue interest! Stake jumped to $${gameData.loan.outstanding.toLocaleString()}.`
                : `📈 Interest hit. Stake now $${gameData.loan.outstanding.toLocaleString()}.`;

            addToHistory('loan', message, false, { countGame: false });
            if (overdue) {
                showNotification('Stake overdue! Interest skyrocketed.', 'error');
            }

            updateLoanUI();
            saveGameData();
        }

        function updateLoanUI() {
            const outstanding = Math.max(0, Math.ceil(gameData.loan.outstanding));
            const principal = gameData.loan.principal || outstanding || 1;
            const interestPercent = principal > 0 ? ((gameData.loan.outstanding / principal) - 1) * 100 : 0;

            document.getElementById('loanOutstanding').textContent = `$${outstanding.toLocaleString()}`;
            document.getElementById('loanInterest').textContent = `${Math.max(0, interestPercent).toFixed(1)}%`;

            const now = Date.now();
            const timerEl = document.getElementById('loanTimer');

            if (outstanding > 0 && gameData.loan.dueAt) {
                const remaining = gameData.loan.dueAt - now;
                timerEl.textContent = remaining > 0
                    ? `${formatDuration(remaining)} remaining`
                    : `Overdue by ${formatDuration(now - gameData.loan.dueAt)}`;
            } else {
                const cooldownRemaining = Math.max(0, (gameData.loan.lastTakenAt + 10 * 60 * 1000) - now);
                timerEl.textContent = cooldownRemaining > 0 ? `Cooldown ${formatDuration(cooldownRemaining)}` : 'Ready';
            }

            document.getElementById('loanRepayBtn').disabled = outstanding <= 0;
            document.getElementById('loanForfeitBtn').disabled = outstanding <= 0;
            document.getElementById('loanRequestBtn').disabled = outstanding > 0;
        }

        function startLoanTicker() {
            if (loanTickHandle) {
                clearTimeout(loanTickHandle);
            }
            loanTick();
        }

        function loanTick() {
            updateLoanUI();

            if (gameData.loan.outstanding > 0) {
                const now = Date.now();

                if (gameData.loan.nextInterestTick && now >= gameData.loan.nextInterestTick) {
                    applyLoanInterest();
                }

                const remaining = gameData.loan.dueAt - now;

                if (remaining <= 0) {
                    document.getElementById('loanWarning').textContent = `⚠️ Overdue! Interest spikes every minute.`;
                    if (gameData.loan.autoForfeitAt && now >= gameData.loan.autoForfeitAt) {
                        autoForfeitLoan();
                    }
                } else if (remaining <= 15 * 60 * 1000) {
                    document.getElementById('loanWarning').textContent = `⚠️ Due soon: ${formatDuration(remaining)} remaining.`;
                    if (!gameData.loan.warningIssued && remaining <= 10 * 60 * 1000) {
                        showNotification('Stake due in under 10 minutes!', 'warning');
                        gameData.loan.warningIssued = true;
                    }
                } else {
                    document.getElementById('loanWarning').textContent = '';
                }
            } else {
                document.getElementById('loanWarning').textContent = '';
            }

            loanTickHandle = setTimeout(loanTick, 1000);
        }

        function formatDuration(ms) {
            const totalSeconds = Math.max(0, Math.floor(ms / 1000));
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            const parts = [];
            if (hours > 0) parts.push(`${hours}h`);
            if (minutes > 0 || hours > 0) parts.push(`${minutes}m`);
            parts.push(`${seconds}s`);
            return parts.join(' ');
        }

        function animateButton(button) {
            if (!button) {
                console.error('No button provided to animate');
                return;
            }
            button.classList.add('btn-click');
            setTimeout(() => button.classList.remove('btn-click'), 300);
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon;
            switch(type) {
                case 'success': icon = 'fas fa-check-circle'; break;
                case 'error': icon = 'fas fa-times-circle'; break;
                case 'warning': icon = 'fas fa-exclamation-triangle'; break;
                default: icon = 'fas fa-info-circle';
            }
            
            notification.innerHTML = `<i class="${icon}"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 4000);
        }

        function showAchievementPopup(achievement) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementIcon').textContent = achievement.icon;
            document.getElementById('achievementTitle').textContent = achievement.name;
            document.getElementById('achievementDesc').textContent = achievement.description;
            document.getElementById('achievementReward').textContent = achievement.reward > 0 ? `+$${achievement.reward.toLocaleString()}` : 'GAME COMPLETE!';
            
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 4000);
        }

        function checkAchievements() {
            for (let id in achievements) {
                if (!gameData.achievements[id] && achievements[id].condition()) {
                    gameData.achievements[id] = true;
                    if (achievements[id].reward > 0) {
                        gameData.balance += achievements[id].reward;
                        updateBalance();
                        updateProgress();
                    }
                    showAchievementPopup(achievements[id]);
                    renderAchievements();
                    saveGameData();
                }
            }
        }

        function renderAchievements() {
            const container = document.getElementById('achievementsGrid');
            container.innerHTML = '';
            
            for (let id in achievements) {
                const achievement = achievements[id];
                const unlocked = gameData.achievements[id];
                const progress = achievement.progress();
                const percent = Math.round(progress * 100);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${unlocked ? 'unlocked' : ''}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-description">${achievement.description}</div>
                    ${!unlocked ? `
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: ${percent}%"></div>
                        </div>
                        <div>${percent}% complete</div>
                    ` : ''}
                    <div class="achievement-reward">Reward: ${achievement.reward > 0 ? achievement.reward.toLocaleString() : 'VICTORY!'}</div>
                    ${unlocked ? '<div style="color: var(--success); margin-top: 15px; font-weight: bold;">✅ UNLOCKED</div>' : '<div style="color: var(--warning); margin-top: 15px;">🔒 Locked</div>'}
                `;
                
                container.appendChild(card);
            }
        }

        function flipCoin() {
            if (gameData.gameStates.coinFlipping) return;
            
            const bet = parseInt(document.getElementById('coinflipBet').value);
            const choice = document.getElementById('coinflipChoice').value;
            
            if (!validateBet(bet)) return;
            
            const button = document.getElementById('coinflipBtn');
            animateButton(button);
            button.disabled = true;
            gameData.gameStates.coinFlipping = true;
            gameData.totalWagered += bet;
            
            const coin = document.getElementById('coin');
            coin.classList.add('flipping');
            
            setTimeout(() => {
                const playerWins = Math.random() < 0.43;
                const result = playerWins ? choice : (choice === 'heads' ? 'tails' : 'heads');
                
                coin.classList.remove('flipping');
                coin.style.transform = `rotateY(${result === 'heads' ? 0 : 180}deg)`;
                
                let message, isWin;
                if (playerWins) {
                    const winnings = Math.floor(bet * 1.9);
                    gameData.balance += winnings;
                    gameData.totalWon += winnings;
                    gameData.stats.coinflip.profit += winnings - bet;
                    message = `🎉 ${result.toUpperCase()}! You won ${winnings}! (1.9x)`;
                    isWin = true;
                    showNotification(`Won ${winnings}!`, 'success');
                } else {
                    gameData.balance -= bet;
                    gameData.stats.coinflip.profit -= bet;
                    message = `💔 ${result.toUpperCase()}! You lost ${bet}!`;
                    isWin = false;
                    showNotification(`Lost ${bet}!`, 'error');
                }
                
                updateBalance();
                updateProgress();
                updateStats();
                showResult('coinflipResult', message, isWin);
                addToHistory('coinflip', message, isWin);
                checkAchievements();
                
                button.disabled = false;
                gameData.gameStates.coinFlipping = false;
                saveGameData();
            }, 4000);
        }

        function startStreak() {
            const bet = parseInt(document.getElementById('coinflipBet').value);
            const choice = document.getElementById('coinflipChoice').value;
            
            if (!validateBet(bet)) return;
            
            gameData.gameStates.coinStreak = {
                active: true,
                count: 0,
                bet: bet,
                choice: choice,
                multiplier: 3
            };
            
            document.getElementById('streakBtn').style.display = 'none';
            document.getElementById('coinflipBtn').style.display = 'none';
            document.getElementById('doubleBtn').style.display = 'inline-block';
            document.getElementById('cashoutStreakBtn').style.display = 'inline-block';
            
            showNotification('Streak started! Win 3 in a row for 3x payout!', 'info');
        }

        function doubleOrNothing() {
            if (!gameData.gameStates.coinStreak.active) return;
            
            const streak = gameData.gameStates.coinStreak;
            const bet = streak.bet * Math.pow(2, streak.count);
            
            if (!validateBet(bet)) {
                cashoutStreak();
                return;
            }
            
            const button = document.getElementById('doubleBtn');
            animateButton(button);
            button.disabled = true;
            gameData.gameStates.coinFlipping = true;
            gameData.totalWagered += bet;
            
            const coin = document.getElementById('coin');
            coin.classList.add('flipping');
            
            setTimeout(() => {
                const winChance = 0.45 - (streak.count * 0.05);
                const playerWins = Math.random() < winChance;
                const result = playerWins ? streak.choice : (streak.choice === 'heads' ? 'tails' : 'heads');
                
                coin.classList.remove('flipping');
                coin.style.transform = `rotateY(${result === 'heads' ? 0 : 180}deg)`;
                
                if (playerWins) {
                    streak.count++;
                    if (streak.count >= 3) {
                        const winnings = Math.floor(streak.bet * streak.multiplier);
                        gameData.balance += winnings;
                        gameData.totalWon += winnings;
                        gameData.stats.coinflip.profit += winnings - streak.bet;
                        
                        const message = `🔥 STREAK COMPLETE! You won ${winnings}! (${streak.multiplier}x)`;
                        showResult('coinflipResult', message, true);
                        addToHistory('coinflip', message, true);
                        showNotification(`Streak complete! Won ${winnings}!`, 'success');
                        
                        endStreak();
                    } else {
                        const message = `🎉 ${result.toUpperCase()}! Streak: ${streak.count}/3`;
                        showResult('coinflipResult', message, true);
                        showNotification(`Streak continues! ${streak.count}/3`, 'info');
                    }
                } else {
                    gameData.balance -= bet;
                    gameData.stats.coinflip.profit -= bet;
                    
                    const message = `💔 ${result.toUpperCase()}! Streak ended! Lost ${bet}!`;
                    showResult('coinflipResult', message, false);
                    addToHistory('coinflip', message, false);
                    showNotification(`Streak ended! Lost ${bet}!`, 'error');
                    
                    endStreak();
                }
                
                updateBalance();
                updateProgress();
                updateStats();
                checkAchievements();
                
                button.disabled = false;
                gameData.gameStates.coinFlipping = false;
                saveGameData();
            }, 4000);
        }

        function cashoutStreak() {
            if (!gameData.gameStates.coinStreak.active) return;
            
            const streak = gameData.gameStates.coinStreak;
            const winnings = Math.floor(streak.bet * streak.count);
            
            if (streak.count > 0) {
                gameData.balance += winnings;
                gameData.totalWon += winnings;
                gameData.stats.coinflip.profit += winnings - streak.bet;
                
                const message = `💰 Cashed out! You won ${winnings}! (Streak: ${streak.count})`;
                showResult('coinflipResult', message, true);
                addToHistory('coinflip', message, true);
                showNotification(`Cashed out! Won ${winnings}!`, 'success');
            } else {
                showNotification('Streak cashed out with no wins', 'info');
            }
            
            endStreak();
            updateBalance();
            updateProgress();
            saveGameData();
        }

        function endStreak() {
            gameData.gameStates.coinStreak = { active: false, count: 0, bet: 0, choice: '', multiplier: 3 };
            document.getElementById('streakBtn').style.display = 'inline-block';
            document.getElementById('coinflipBtn').style.display = 'inline-block';
            document.getElementById('doubleBtn').style.display = 'none';
            document.getElementById('cashoutStreakBtn').style.display = 'none';
        }

        function handleRouletteBetTypeChange() {
            const type = document.getElementById('rouletteBetType').value;
            const numberGroup = document.getElementById('rouletteNumberGroup');
            if (numberGroup) {
                numberGroup.style.display = type === 'single' ? 'block' : 'none';
            }
        }

        function spinRoulette() {
            if (gameData.gameStates.rouletteSpinning) return;

            const betAmount = parseInt(document.getElementById('rouletteBet').value);
            if (!validateBet(betAmount)) return;

            const betType = document.getElementById('rouletteBetType').value;
            let betNumber = null;

            if (betType === 'single') {
                betNumber = parseInt(document.getElementById('rouletteNumber').value);
                if (isNaN(betNumber) || betNumber < 0 || betNumber > 36) {
                    showNotification('Choose a number between 0 and 36.', 'error');
                    return;
                }
            }

            const spinBtn = document.getElementById('rouletteSpinBtn');
            animateButton(spinBtn);
            spinBtn.disabled = true;

            const wheel = document.getElementById('rouletteWheel');
            if (!wheel) {
                showNotification('Roulette wheel is unavailable.', 'error');
                spinBtn.disabled = false;
                return;
            }

            gameData.gameStates.rouletteSpinning = true;
            gameData.balance -= betAmount;
            gameData.totalWagered += betAmount;
            gameData.gameStates.rouletteBet = betAmount;
            gameData.gameStates.rouletteChoice = { type: betType, number: betNumber };
            updateBalance();
            updateProgress();

            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            void wheel.offsetWidth;
            const spinDegrees = 720 + Math.floor(Math.random() * 360);
            wheel.style.transition = 'transform 3s cubic-bezier(0.25, 0.1, 0.25, 1)';
            wheel.style.transform = `rotate(${spinDegrees}deg)`;

            const rawResult = rollRouletteNumber();
            const finalResult = rigRouletteResult(rawResult, betType, betNumber);

            setTimeout(() => {
                finalizeRouletteSpin(finalResult, betType, betNumber, betAmount);
                spinBtn.disabled = false;
            }, 3100);
        }

        function finalizeRouletteSpin(result, betType, betNumber, betAmount) {
            gameData.gameStates.rouletteSpinning = false;

            const color = getRouletteColor(result);
            const isWin = willRouletteBetWin(result, betType, betNumber);
            let winnings = 0;

            if (isWin) {
                const multiplier = getRoulettePayoutMultiplier(betType);
                winnings = betAmount * multiplier;
                gameData.balance += winnings;
                gameData.totalWon += winnings;
                gameData.stats.roulette.profit += winnings - betAmount;
                if (winnings > gameData.stats.roulette.maxPayout) {
                    gameData.stats.roulette.maxPayout = winnings;
                }
            } else {
                gameData.stats.roulette.profit -= betAmount;
            }

            updateBalance();
            updateProgress();
            updateStats();

            const message = isWin
                ? `🎡 ${formatRouletteResult(result, color)}! Won $${winnings.toLocaleString()}!`
                : `🎡 ${formatRouletteResult(result, color)}. Lost $${betAmount.toLocaleString()}.`;

            showResult('rouletteResult', message, isWin);
            addToHistory('roulette', message, isWin, { number: result, color: color.toUpperCase() });

            trackRouletteNumber(result, color);
            updateRouletteTicker();
            updateRouletteStats();
            saveGameData();
        }

        function rollRouletteNumber() {
            if (Math.random() < 0.04) {
                return 0;
            }
            return Math.floor(Math.random() * 37);
        }

        function rigRouletteResult(candidate, betType, betNumber) {
            let result = candidate;
            if (Math.random() < 0.06) {
                result = 0;
            }

            if (willRouletteBetWin(result, betType, betNumber) && Math.random() < 0.08) {
                result = findLosingNumber(betType, betNumber, result);
            }

            return result;
        }

        function findLosingNumber(betType, betNumber, fallback) {
            for (let i = 0; i < 25; i++) {
                const candidate = Math.floor(Math.random() * 37);
                if (!willRouletteBetWin(candidate, betType, betNumber)) {
                    return candidate;
                }
            }
            return fallback === 0 ? 1 : 0;
        }

        function willRouletteBetWin(result, betType, betNumber) {
            if (betType === 'single') {
                return result === betNumber;
            }

            if (result === 0) {
                return false;
            }

            switch (betType) {
                case 'red':
                    return rouletteRedNumbers.has(result);
                case 'black':
                    return !rouletteRedNumbers.has(result);
                case 'even':
                    return result % 2 === 0;
                case 'odd':
                    return result % 2 === 1;
                case 'low':
                    return result >= 1 && result <= 18;
                case 'high':
                    return result >= 19 && result <= 36;
                case 'dozen1':
                    return result >= 1 && result <= 12;
                case 'dozen2':
                    return result >= 13 && result <= 24;
                case 'dozen3':
                    return result >= 25 && result <= 36;
                default:
                    return false;
            }
        }

        function getRoulettePayoutMultiplier(betType) {
            return roulettePayouts[betType] || 2;
        }

        function getRouletteColor(number) {
            if (number === 0) return 'green';
            return rouletteRedNumbers.has(number) ? 'red' : 'black';
        }

        function formatRouletteResult(number, color) {
            const colorLabel = color.toUpperCase();
            return `${number} ${colorLabel}`;
        }

        function trackRouletteNumber(number, color) {
            if (!Array.isArray(gameData.gameStates.rouletteRecentNumbers)) {
                gameData.gameStates.rouletteRecentNumbers = [];
            }
            gameData.gameStates.rouletteRecentNumbers.unshift({ number, color });
            if (gameData.gameStates.rouletteRecentNumbers.length > 10) {
                gameData.gameStates.rouletteRecentNumbers.pop();
            }
        }

        function updateRouletteTicker() {
            const container = document.getElementById('rouletteRecent');
            if (!container) return;

            container.innerHTML = '';
            if (!Array.isArray(gameData.gameStates.rouletteRecentNumbers)) return;

            gameData.gameStates.rouletteRecentNumbers.forEach(item => {
                const chip = document.createElement('div');
                chip.className = `roulette-chip ${item.color}`;
                chip.textContent = item.number;
                container.appendChild(chip);
            });
        }

        function updateRouletteStats() {
            const totalSpins = gameData.stats.roulette.wins + gameData.stats.roulette.losses;
            const winRate = totalSpins > 0 ? Math.round((gameData.stats.roulette.wins / totalSpins) * 100) : 0;
            const winRateEl = document.getElementById('rouletteWinRate');
            const maxPayoutEl = document.getElementById('rouletteMaxPayout');
            const lastLabelEl = document.getElementById('rouletteLastLabel');

            if (winRateEl) {
                winRateEl.textContent = `${winRate}%`;
            }
            if (maxPayoutEl) {
                maxPayoutEl.textContent = `$${gameData.stats.roulette.maxPayout.toLocaleString()}`;
            }
            if (lastLabelEl) {
                const recent = gameData.gameStates.rouletteRecentNumbers && gameData.gameStates.rouletteRecentNumbers[0];
                lastLabelEl.textContent = recent ? `${recent.number} ${recent.color.toUpperCase()}` : '--';
            }
        }

        function repeatRouletteBet() {
            const lastBet = gameData.gameStates.rouletteBet;
            const lastChoice = gameData.gameStates.rouletteChoice;

            if (!lastBet || !lastChoice) {
                showNotification('No previous roulette bet to repeat.', 'info');
                return;
            }

            document.getElementById('rouletteBet').value = lastBet;
            document.getElementById('rouletteBetType').value = lastChoice.type;
            handleRouletteBetTypeChange();

            if (lastChoice.type === 'single') {
                document.getElementById('rouletteNumber').value = lastChoice.number ?? '';
            }

            spinRoulette();
        }

        function spinSlots() {
            if (gameData.gameStates.slotsSpinning) return;
            
            const bet = parseInt(document.getElementById('slotsBet').value);
            if (!validateBet(bet)) return;
            
            const button = document.getElementById('slotsBtn');
            animateButton(button);
            button.disabled = true;
            gameData.gameStates.slotsSpinning = true;
            gameData.totalWagered += bet;
            gameData.stats.slots.spins++;
            gameData.gameStates.slotsBonusCounter++;
            
            gameData.gameStates.slotsJackpot += Math.floor(bet * 0.05);
            updateJackpotDisplay();
            
            const symbols = slotSymbols;
            const results = [];
            
            const luck = Math.random();
            let forcedResults = null;
            
            if (gameData.gameStates.slotsBonusCounter % 6 === 0) {
                const possibleWins = [
                    ['💎', '💎', '💎'], 
                    ['⭐', '⭐', '⭐'], 
                    ['🔔', '🔔', '🔔'],
                    ['🍀', '🍀', '🍀'], 
                    ['7️⃣', '7️⃣', '7️⃣'] 
                ];
                
                forcedResults = possibleWins[Math.floor(Math.random() * possibleWins.length)];
            } else if (luck < 0.01) { 
                forcedResults = ['💎', '💎', '💎'];
            } else if (luck < 0.05) { 
                const symbol = symbols[Math.floor(Math.random() * 6)];
                forcedResults = [symbol, symbol, symbol];
            } else if (luck < 0.15) { 
                const symbol = symbols[Math.floor(Math.random() * symbols.length)];
                forcedResults = [symbol, symbol, symbols[Math.floor(Math.random() * symbols.length)]];
            }
            
            for (let i = 1; i <= 3; i++) {
                const slot = document.getElementById(`slot${i}`);
                slot.classList.add('spinning');
                
                let spins = 0;
                const spinInterval = setInterval(() => {
                    slot.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                    spins++;
                    
                    if (spins > 15 + (i * 5)) {
                        clearInterval(spinInterval);
                        
                        const finalSymbol = forcedResults ? forcedResults[i-1] : symbols[Math.floor(Math.random() * symbols.length)];
                        slot.textContent = finalSymbol;
                        slot.classList.remove('spinning');
                        results.push(finalSymbol);
                        
                        if (results.length === 3) {
                            calculateSlotsResult(bet, results);
                            button.disabled = false;
                            gameData.gameStates.slotsSpinning = false;
                        }
                    }
                }, 100);
            }
        }

        function updateJackpotDisplay() {
            document.getElementById('jackpotAmount').textContent = gameData.gameStates.slotsJackpot.toLocaleString();
            const jackpotPercent = Math.min((gameData.gameStates.slotsJackpot - 10000) / 90000 * 100, 100);
            document.getElementById('jackpotFill').style.width = jackpotPercent + '%';
            document.getElementById('jackpotValue').textContent = jackpotPercent.toFixed(1) + '%';
            document.getElementById('bonusSpins').textContent = 5 - (gameData.gameStates.slotsBonusCounter % 5);
        }

        function calculateSlotsResult(bet, results) {
            let multiplier = 0;
            let message;
            
            const resultStr = results.join('');
            if (slotPayouts[resultStr]) {
                multiplier = slotPayouts[resultStr];
            } else if (results[0] === results[1] || results[1] === results[2] || results[0] === results[2]) {
                multiplier = 1.5;
            }
            
            let isWin;
            if (multiplier > 0) {
                let winnings = Math.floor(bet * multiplier);
                
                if (results[0] === '💎' && results[1] === '💎' && results[2] === '💎') {
                    winnings += gameData.gameStates.slotsJackpot;
                    gameData.gameStates.slotsJackpot = 10000; 
                    gameData.stats.slots.jackpots++;
                    message = `🎰 JACKPOT!!! You won ${winnings} (${multiplier}x + JACKPOT)`;
                    showNotification('JACKPOT!!!', 'success');
                } else {
                    message = `🎰 WINNER! You won ${winnings}! (${multiplier}x)`;
                    showNotification(`Slots win! ${winnings}!`, 'success');
                }
                
                gameData.balance += winnings;
                gameData.totalWon += winnings;
                gameData.stats.slots.profit += winnings - bet;
                gameData.stats.slots.wins++;
                isWin = true;
            } else {
                gameData.balance -= bet;
                gameData.stats.slots.profit -= bet;
                gameData.stats.slots.losses++;
                message = `💸 No match! You lost ${bet}!`;
                isWin = false;
                showNotification(`Lost ${bet}!`, 'error');
            }
            
            updateBalance();
            updateProgress();
            updateStats();
            updateJackpotDisplay();
            showResult('slotsResult', message, isWin);
            addToHistory('slots', message, isWin);
            checkAchievements();
            saveGameData();
        }

        function startBlackjack() {
            const bet = parseInt(document.getElementById('blackjackBet').value);
            if (!validateBet(bet)) return;
            
            const button = document.getElementById('blackjackStart');
            animateButton(button);
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                
                gameData.gameStates.blackjackActive = true;
                gameData.gameStates.blackjackBet = bet;
                gameData.gameStates.playerHand = [];
                gameData.gameStates.dealerHand = [];
                gameData.gameStates.gamePhase = 'playerTurn';
                gameData.totalWagered += bet;
                
                gameData.balance -= bet;
                updateBalance();
                
                document.getElementById('blackjackStart').style.display = 'none';
                document.getElementById('blackjackPlayingArea').style.display = 'block';
                
                dealCard('player');
                dealCard('dealer');
                dealCard('player');
                const dealerCard = dealCard('dealer', true); 
                
                const playerValue = calculateHandValue(gameData.gameStates.playerHand);
                if (playerValue === 21) {
                    setTimeout(() => dealerTurn(), 1000);
                }
                
                if (dealerCard.value === 'A') {
                    document.getElementById('insuranceBtn').style.display = 'inline-block';
                }
                
                if (gameData.gameStates.playerHand[0].value === gameData.gameStates.playerHand[1].value) {
                    document.getElementById('splitBtn').style.display = 'inline-block';
                }
                
                saveGameData();
            }, 1000);
        }

        function dealCard(target, hidden = false) {
            let suit = cardSuits[Math.floor(Math.random() * cardSuits.length)];
            let value;
            
            if (target === 'dealer' && Math.random() < 0.15) {
                const goodCards = ['10', 'J', 'Q', 'K', 'A'];
                value = goodCards[Math.floor(Math.random() * goodCards.length)];
            } else if (target === 'player' && Math.random() < 0.10) {
                const currentValue = calculateHandValue(gameData.gameStates.playerHand);
                if (currentValue >= 12) {
                    const badCards = ['8', '9', '10', 'J', 'Q', 'K'];
                    value = badCards[Math.floor(Math.random() * badCards.length)];
                } else {
                    value = cardValues[Math.floor(Math.random() * cardValues.length)];
                }
            } else {
                value = cardValues[Math.floor(Math.random() * cardValues.length)];
            }
            
            const card = { suit, value, hidden };
            gameData.gameStates[`${target}Hand`].push(card);
            renderHand(target);
            
            return card;
        }

        function renderHand(target) {
            const handElement = document.getElementById(`${target}Hand`);
            handElement.innerHTML = '';
            
            gameData.gameStates[`${target}Hand`].forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                
                if (card.hidden && gameData.gameStates.gamePhase === 'playerTurn') {
                    cardElement.textContent = '🂠';
                    cardElement.style.background = 'linear-gradient(45deg, #1a1a2e, #16213e)';
                } else {
                    cardElement.className += ` ${card.suit === '♥' || card.suit === '♦' ? 'red' : 'black'}`;
                    
                    const valueElement = document.createElement('div');
                    valueElement.className = 'card-value';
                    valueElement.textContent = card.value;
                    cardElement.appendChild(valueElement);
                    
                    const suitElement = document.createElement('div');
                    suitElement.className = 'card-suit';
                    suitElement.textContent = card.suit;
                    cardElement.appendChild(suitElement);
                }
                
                handElement.appendChild(cardElement);
            });
            
            const playerValue = calculateHandValue(gameData.gameStates.playerHand);
            const dealerVisibleValue = target === 'dealer' && gameData.gameStates.gamePhase === 'playerTurn' 
                ? calculateHandValue(gameData.gameStates.dealerHand.filter(c => !c.hidden))
                : calculateHandValue(gameData.gameStates.dealerHand);
            
            document.getElementById('playerValue').textContent = playerValue;
            document.getElementById('dealerValue').textContent = 
                target === 'dealer' && gameData.gameStates.gamePhase === 'playerTurn' ? '?' : dealerVisibleValue;
        }

        function calculateHandValue(hand) {
            let value = 0;
            let aces = 0;
            
            hand.filter(card => !card.hidden).forEach(card => {
                if (card.value === 'A') {
                    value += 11;
                    aces++;
                } else if (['J', 'Q', 'K'].includes(card.value)) {
                    value += 10;
                } else {
                    value += parseInt(card.value);
                }
            });
            
            while (value > 21 && aces > 0) {
                value -= 10;
                aces--;
            }
            
            return value;
        }

        function blackjackHit() {
            if (!gameData.gameStates.blackjackActive || gameData.gameStates.gamePhase !== 'playerTurn') return;
            
            animateButton(document.querySelector('#blackjackActions .btn-success'));
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                dealCard('player');
                
                const playerValue = calculateHandValue(gameData.gameStates.playerHand);
                if (playerValue > 21) {
                    endBlackjack(false, 'Player busts!');
                } else if (playerValue === 21) {
                    dealerTurn();
                }
                
                saveGameData();
            }, 500);
        }

        function blackjackStand() {
            if (!gameData.gameStates.blackjackActive || gameData.gameStates.gamePhase !== 'playerTurn') return;
            
            animateButton(document.querySelector('#blackjackActions .btn-danger'));
            dealerTurn();
        }

        function blackjackDouble() {
            if (!gameData.gameStates.blackjackActive || gameData.gameStates.gamePhase !== 'playerTurn') return;
            
            const additionalBet = gameData.gameStates.blackjackBet;
            if (gameData.balance < additionalBet) {
                showNotification('Insufficient balance to double!', 'error');
                return;
            }
            
            animateButton(document.querySelector('#blackjackActions .btn-gold'));
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                gameData.balance -= additionalBet;
                gameData.gameStates.blackjackBet *= 2;
                gameData.totalWagered += additionalBet;
                updateBalance();
                
                dealCard('player');
                
                const playerValue = calculateHandValue(gameData.gameStates.playerHand);
                if (playerValue > 21) {
                    endBlackjack(false, 'Player busts after double!');
                } else {
                    dealerTurn();
                }
            }, 500);
        }

        function blackjackSplit() {
            const additionalBet = gameData.gameStates.blackjackBet;
            if (gameData.balance < additionalBet) {
                showNotification('Insufficient balance to split!', 'error');
                return;
            }
            
            animateButton(document.getElementById('splitBtn'));
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                gameData.balance -= additionalBet;
                gameData.gameStates.blackjackBet *= 2;
                gameData.totalWagered += additionalBet;
                updateBalance();
                
                document.getElementById('splitBtn').style.display = 'none';
                
                dealCard('player');
                
                saveGameData();
            }, 500);
        }

        function blackjackInsurance() {
            const insuranceBet = Math.floor(gameData.gameStates.blackjackBet / 2);
            if (gameData.balance < insuranceBet) {
                showNotification('Insufficient balance for insurance!', 'error');
                return;
            }
            
            if (confirm(`Buy insurance for $${insuranceBet}? Pays 2:1 if dealer has blackjack.`)) {
                gameData.balance -= insuranceBet;
                gameData.totalWagered += insuranceBet;
                updateBalance();
                
                const dealerValue = calculateHandValue(gameData.gameStates.dealerHand);
                if (dealerValue === 21) {
                    const payout = insuranceBet * 2;
                    gameData.balance += payout;
                    gameData.totalWon += payout;
                    showNotification(`Insurance paid out $${payout}!`, 'success');
                } else {
                    showNotification('Insurance lost', 'info');
                }
                
                document.getElementById('insuranceBtn').style.display = 'none';
                saveGameData();
            }
        }

        function dealerTurn() {
            gameData.gameStates.gamePhase = 'dealerTurn';
            
            gameData.gameStates.dealerHand.forEach(card => card.hidden = false);
            renderHand('dealer');
            
            document.getElementById('insuranceBtn').style.display = 'none';
            document.getElementById('splitBtn').style.display = 'none';
            
            const drawCard = () => {
                const dealerValue = calculateHandValue(gameData.gameStates.dealerHand);
                
                if (dealerValue < 17) {
                    setTimeout(() => {
                        dealCard('dealer');
                        drawCard();
                    }, 1000);
                } else {
                    const playerValue = calculateHandValue(gameData.gameStates.playerHand);
                    
                    if (dealerValue > 21) {
                        endBlackjack(true, 'Dealer busts! You win!');
                    } else if (playerValue > dealerValue) {
                        endBlackjack(true, `You win! ${playerValue} vs ${dealerValue}`);
                    } else if (dealerValue > playerValue) {
                        endBlackjack(false, `Dealer wins! ${dealerValue} vs ${playerValue}`);
                    } else {
                        endBlackjack(null, `Push! Both have ${playerValue}`);
                    }
                }
            };
            
            drawCard();
        }

        function endBlackjack(playerWins, reason) {
            gameData.gameStates.blackjackActive = false;
            gameData.gameStates.gamePhase = 'gameOver';
            
            const bet = gameData.gameStates.blackjackBet;
            let message;
            
            if (playerWins === true) {
                const playerValue = calculateHandValue(gameData.gameStates.playerHand);
                const isBlackjack = playerValue === 21 && gameData.gameStates.playerHand.length === 2;
                const winnings = isBlackjack ? Math.floor(bet * 1.5) : bet;
                
                gameData.balance += winnings + bet;
                gameData.totalWon += winnings;
                gameData.stats.blackjack.profit += winnings;
                message = `🎉 ${reason} Won ${winnings}!`;
                showNotification(`Blackjack! Won ${winnings}!`, 'success');
                addToHistory('blackjack', message, true);
            } else if (playerWins === false) {
                gameData.stats.blackjack.profit -= bet;
                message = `💔 ${reason} Lost ${bet}!`;
                showNotification(`Lost ${bet}!`, 'error');
                addToHistory('blackjack', message, false);
            } else {
                gameData.balance += bet;
                message = `🤝 ${reason} Bet returned.`;
                showNotification('Push! Bet returned.', 'info');
                addToHistory('blackjack', message, null);
            }
            
            updateBalance();
            updateProgress();
            updateStats();
            showResult('blackjackResult', message, playerWins);
            checkAchievements();
            
            setTimeout(() => {
                document.getElementById('blackjackStart').style.display = 'inline-block';
                document.getElementById('blackjackPlayingArea').style.display = 'none';
                document.getElementById('blackjackResult').textContent = '';
            }, 3000);
            
            saveGameData();
        }

        function selectMineOption(element, mines) {
            document.querySelectorAll('.mine-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            element.classList.add('selected');
            gameData.gameStates.minesCount = mines;
        }

        function startMines() {
            const bet = parseInt(document.getElementById('minesBet').value);
            if (!validateBet(bet)) return;
            
            const button = document.getElementById('minesStart');
            animateButton(button);
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                
                gameData.gameStates.minesActive = true;
                gameData.gameStates.minesBet = bet;
                gameData.gameStates.minesRevealed = 0;
                gameData.totalWagered += bet;
                gameData.balance -= bet;
                updateBalance();
                
                document.getElementById('minesStart').style.display = 'none';
                document.getElementById('minesCashout').style.display = 'inline-block';
                
                if (gameData.gameStates.minesPowerups.reveal > 0) {
                    document.getElementById('revealPowerup').style.display = 'inline-block';
                    document.getElementById('revealPowerup').innerHTML = `<i class="fas fa-eye"></i> Reveal (${gameData.gameStates.minesPowerups.reveal})`;
                }
                if (gameData.gameStates.minesPowerups.shield > 0) {
                    document.getElementById('shieldPowerup').style.display = 'inline-block';
                    document.getElementById('shieldPowerup').innerHTML = `<i class="fas fa-shield-alt"></i> Shield (${gameData.gameStates.minesPowerups.shield})`;
                }
                
                const grid = document.getElementById('minesGrid');
                grid.innerHTML = '';
                
                const mines = [];
                const totalMines = gameData.gameStates.minesCount;
                
                const extraMines = Math.floor(totalMines * 0.25); 
                const actualMineCount = totalMines + extraMines;
                
                for (let i = 0; i < actualMineCount; i++) {
                    let minePos;
                    do {
                        minePos = Math.floor(Math.random() * 25);
                    } while (mines.includes(minePos));
                    mines.push(minePos);
                }
                
                gameData.gameStates.minesGrid = mines;
                
                for (let i = 0; i < 25; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'mine-cell';
                    cell.dataset.index = i;
                    cell.onclick = () => revealMine(cell, i);
                    grid.appendChild(cell);
                }
                
                saveGameData();
            }, 1000);
        }

        function revealMine(cell, index) {
            if (!gameData.gameStates.minesActive || cell.classList.contains('revealed')) return;
            
            animateButton(cell);
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                
                if (gameData.gameStates.minesGrid.includes(index)) {
                    cell.classList.add('mine');
                    cell.textContent = '💣';
                    gameData.stats.mines.minesHit++;
                    
                    if (gameData.gameStates.minesPowerups.shield > 0) {
                        gameData.gameStates.minesPowerups.shield--;
                        document.getElementById('shieldPowerup').innerHTML = `<i class="fas fa-shield-alt"></i> Shield (${gameData.gameStates.minesPowerups.shield})`;
                        if (gameData.gameStates.minesPowerups.shield === 0) {
                            document.getElementById('shieldPowerup').style.display = 'none';
                        }
                        
                        cell.classList.remove('mine');
                        cell.classList.add('revealed');
                        cell.textContent = '💎';
                        gameData.gameStates.minesRevealed++;
                        
                        showNotification('Shield protected you from a mine!', 'success');
                        return;
                    }
                    
                    gameData.gameStates.minesActive = false;
                    document.getElementById('minesCashout').style.display = 'none';
                    document.getElementById('revealPowerup').style.display = 'none';
                    document.getElementById('shieldPowerup').style.display = 'none';
                    
                    document.querySelectorAll('.mine-cell').forEach((mineCell, idx) => {
                        if (gameData.gameStates.minesGrid.includes(idx)) {
                            mineCell.classList.add('mine');
                            mineCell.textContent = '💣';
                        }
                    });
                    
                    const message = `💣 BOOM! You hit a mine! Lost ${gameData.gameStates.minesBet}!`;
                    showResult('minesResult', message, false);
                    addToHistory('mines', message, false);
                    showNotification(`Mine explosion! Lost ${gameData.gameStates.minesBet}!`, 'error');
                    checkAchievements();
                } else {
                    cell.classList.add('revealed');
                    cell.textContent = '💎';
                    gameData.gameStates.minesRevealed++;
                    
                    const safeSpots = 25 - gameData.gameStates.minesGrid.length;
                    const multiplier = 1 + (gameData.gameStates.minesRevealed / safeSpots) * (gameData.gameStates.minesCount / 3);
                    showResult('minesResult', `💎 Safe! Current multiplier: ${multiplier.toFixed(2)}x`);
                }
                
                updateStats();
                saveGameData();
            }, 500);
        }

        function cashoutMines() {
            if (!gameData.gameStates.minesActive) return;
            
            animateButton(document.getElementById('minesCashout'));
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                
                const safeSpots = 25 - gameData.gameStates.minesGrid.length;
                const multiplier = 1 + (gameData.gameStates.minesRevealed / safeSpots) * (gameData.gameStates.minesCount / 3);
                const winnings = Math.floor(gameData.gameStates.minesBet * multiplier);
                
                gameData.balance += winnings;
                gameData.totalWon += winnings;
                gameData.stats.mines.profit += winnings - gameData.gameStates.minesBet;
                if (winnings > gameData.stats.mines.highestCashout) {
                    gameData.stats.mines.highestCashout = winnings;
                }
                updateBalance();
                updateProgress();
                updateStats();
                
                gameData.gameStates.minesActive = false;
                document.getElementById('minesStart').style.display = 'inline-block';
                document.getElementById('minesCashout').style.display = 'none';
                document.getElementById('revealPowerup').style.display = 'none';
                document.getElementById('shieldPowerup').style.display = 'none';
                
                const message = `💰 Cashed out! You won ${winnings}! (${multiplier.toFixed(2)}x)`;
                showResult('minesResult', message, true);
                addToHistory('mines', message, true);
                showNotification(`Mines cashout! Won ${winnings}!`, 'success');
                checkAchievements();
                saveGameData();
            }, 1000);
        }

        function usePowerup(type) {
            if (!gameData.gameStates.minesActive) return;
            
            if (gameData.gameStates.minesPowerups[type] <= 0) return;
            
            if (type === 'reveal') {
                const safeCells = [];
                document.querySelectorAll('.mine-cell').forEach((cell, index) => {
                    if (!cell.classList.contains('revealed')) {
                        safeCells.push(index);
                    }
                });
                
                if (safeCells.length > 0) {
                    const randomIndex = Math.floor(Math.random() * safeCells.length);
                    const cellIndex = safeCells[randomIndex];
                    const cell = document.querySelector(`.mine-cell[data-index="${cellIndex}"]`);
                    
                    if (!gameData.gameStates.minesGrid.includes(cellIndex)) {
                        revealMine(cell, cellIndex);
                        gameData.gameStates.minesPowerups.reveal--;
                        document.getElementById('revealPowerup').innerHTML = `<i class="fas fa-eye"></i> Reveal (${gameData.gameStates.minesPowerups.reveal})`;
                        
                        if (gameData.gameStates.minesPowerups.reveal === 0) {
                            document.getElementById('revealPowerup').style.display = 'none';
                        }
                        
                        showNotification('Revealed a safe cell!', 'info');
                    }
                }
            }
            
            saveGameData();
        }

        function startCrash() {
            if (gameData.gameStates.crashActive) return;
            
            const bet = parseInt(document.getElementById('crashBet').value);
            if (!validateBet(bet)) return;
            
            const button = document.getElementById('crashStart');
            animateButton(button);
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                
                gameData.gameStates.crashActive = true;
                gameData.gameStates.crashBet = bet;
                gameData.gameStates.crashMultiplier = 1.0;
                gameData.gameStates.crashPlayerOut = false;
                gameData.gameStates.crashAuto.queueNext = false;
                gameData.totalWagered += bet;
                gameData.balance -= bet;
                updateBalance();
                
                document.getElementById('crashStart').style.display = 'none';
                document.getElementById('crashCashout').style.display = 'inline-block';
                
                let crashPoint;
                const rand = Math.random();
                
                if (rand < 0.60) { 
                    crashPoint = 1.01 + Math.random() * 0.35; 
                } else if (rand < 0.85) { 
                    crashPoint = 1.36 + Math.random() * 0.9; 
                } else if (rand < 0.97) { 
                    crashPoint = 2.26 + Math.random() * 2.5; 
                } else { 
                    crashPoint = 5 + Math.random() * 45; 
                }
                
                let startTime = Date.now();
                const duration = Math.min(crashPoint * 1000, 20000);
                
                const updateCrash = () => {
                    if (!gameData.gameStates.crashActive) return;
                    
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(1, elapsed / duration);
                    
                    gameData.gameStates.crashMultiplier = 1 + (progress * (crashPoint - 1));
                    
                    document.getElementById('crashMultiplier').textContent = gameData.gameStates.crashMultiplier.toFixed(2) + 'x';
                    
                    if (gameData.gameStates.crashAuto.active && 
                        gameData.gameStates.crashMultiplier >= gameData.gameStates.crashAuto.cashout) {
                        cashoutCrash();
                        return;
                    }
                    
                    if (gameData.gameStates.crashMultiplier >= crashPoint) {
                        gameData.gameStates.crashActive = false;
                        const playerExited = gameData.gameStates.crashPlayerOut;
                        document.getElementById('crashStart').style.display = 'inline-block';
                        document.getElementById('crashCashout').style.display = 'none';

                        gameData.gameStates.crashHistory.unshift({
                            multiplier: gameData.gameStates.crashMultiplier,
                            crashed: true
                        });
                        if (gameData.gameStates.crashHistory.length > 15) {
                            gameData.gameStates.crashHistory.pop();
                        }
                        updateCrashHistory();

                        if (playerExited) {
                            const message = `🚀💥 Crash finished at ${gameData.gameStates.crashMultiplier.toFixed(2)}x. You were already out.`;
                            showResult('crashResult', message, null);
                            addToHistory('crash', message, null, { countGame: false });
                        } else {
                            const message = `🚀💥 CRASHED at ${gameData.gameStates.crashMultiplier.toFixed(2)}x! Lost ${bet}!`;
                            showResult('crashResult', message, false);
                            addToHistory('crash', message, false);
                            showNotification(`Crash! Lost ${bet}!`, 'error');
                            checkAchievements();
                        }

                        gameData.gameStates.crashPlayerOut = false;

                        if (gameData.gameStates.crashAuto.active && gameData.gameStates.crashAuto.queueNext && gameData.gameStates.crashAuto.remaining > 0) {
                            gameData.gameStates.crashAuto.queueNext = false;
                            setTimeout(() => {
                                if (gameData.gameStates.crashActive) return;
                                document.getElementById('crashBet').value = gameData.gameStates.crashAuto.amount;
                                startCrash();
                            }, 2000);
                        }
                    } else {
                        requestAnimationFrame(updateCrash);
                    }
                };
                
                updateCrash();
                saveGameData();
            }, 1000);
        }

        function cashoutCrash() {
            if (!gameData.gameStates.crashActive) return;
            if (gameData.gameStates.crashPlayerOut) {
                showNotification('Already cashed out this round.', 'info');
                return;
            }
            
            animateButton(document.getElementById('crashCashout'));
            showLoading();
            
            setTimeout(() => {
                showLoading(false);
                
                const winnings = Math.floor(gameData.gameStates.crashBet * gameData.gameStates.crashMultiplier);
                gameData.balance += winnings;
                gameData.totalWon += winnings;
                gameData.stats.crash.profit += winnings - gameData.gameStates.crashBet;
                if (gameData.gameStates.crashMultiplier > gameData.stats.crash.highestMultiplier) {
                    gameData.stats.crash.highestMultiplier = gameData.gameStates.crashMultiplier;
                }
                updateBalance();
                updateProgress();
                updateStats();
                
                gameData.gameStates.crashPlayerOut = true;
                document.getElementById('crashCashout').style.display = 'none';
                
                gameData.gameStates.crashHistory.unshift({
                    multiplier: gameData.gameStates.crashMultiplier,
                    crashed: false
                });
                if (gameData.gameStates.crashHistory.length > 15) {
                    gameData.gameStates.crashHistory.pop();
                }
                updateCrashHistory();
                
                const message = `🚀💰 Cashed out at ${gameData.gameStates.crashMultiplier.toFixed(2)}x! Won ${winnings}!`;
                showResult('crashResult', message, true);
                addToHistory('crash', message, true);
                showNotification(`Crash cashout! Won ${winnings}!`, 'success');
                checkAchievements();
                
                if (gameData.gameStates.crashAuto.active) {
                    gameData.gameStates.crashAuto.remaining--;
                    if (gameData.gameStates.crashAuto.remaining > 0) {
                        gameData.gameStates.crashAuto.queueNext = true;
                    } else {
                        gameData.gameStates.crashAuto.active = false;
                        showNotification('Auto-betting completed!', 'info');
                    }
                }
                
                saveGameData();
            }, 1000);
        }

        function startAutoCrash() {
            const cashout = parseFloat(document.getElementById('autoCashout').value);
            const amount = parseInt(document.getElementById('autoBetAmount').value);
            const count = parseInt(document.getElementById('autoBetCount').value);
            
            if (isNaN(cashout) || cashout < 1.1) {
                showNotification('Auto-cashout must be at least 1.1x', 'error');
                return;
            }
            
            if (!validateBet(amount)) return;
            
            if (isNaN(count) || count < 1) {
                showNotification('Auto-bet count must be at least 1', 'error');
                return;
            }
            
            gameData.gameStates.crashAuto = {
                active: true,
                cashout: cashout,
                amount: amount,
                count: count,
                remaining: count,
                queueNext: false
            };
            
            showNotification(`Auto-betting started: ${count} bets of $${amount} with cashout at ${cashout}x`, 'info');
            
            document.getElementById('crashBet').value = amount;
            startCrash();
        }

        function updateCrashHistory() {
            const historyElement = document.getElementById('crashHistory');
            if (!historyElement) return;
            
            historyElement.innerHTML = '';
            
            gameData.gameStates.crashHistory.slice(0, 12).forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = `crash-history-item ${item.crashed ? 'crash' : 'cashout'}`;
                itemElement.textContent = `${item.multiplier.toFixed(2)}x`;
                historyElement.appendChild(itemElement);
            });
        }

        function initWheel() {
            const wheel = document.getElementById('wheelSpin');
            const labelsContainer = document.getElementById('wheelLabels');
            if (!wheel || !labelsContainer) return;

            const prizes = gameData.gameStates.wheelPrizes;
            const prizeCount = prizes.length;
            const angle = 360 / prizeCount;

            const gradientStops = prizes.map((prize, index) => {
                const start = index * angle;
                const end = (index + 1) * angle;
                return `${prize.color} ${start}deg ${end}deg`;
            }).join(', ');

            wheel.style.background = `conic-gradient(from -${angle / 2}deg, ${gradientStops})`;
            wheel.style.transform = 'rotate(0deg)';
            wheel.dataset.rotation = 0;

            labelsContainer.innerHTML = '';
            const radiusOffset = wheel.clientWidth ? wheel.clientWidth * 0.38 : 114;

            prizes.forEach((prize, index) => {
                const rotation = angle * index + angle / 2;
                const label = document.createElement('div');
                label.className = 'wheel-label';
                label.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;

                const span = document.createElement('span');
                const valueText = typeof prize.text === 'string' ? prize.text : (prize.value === 'JACKPOT' ? 'JACKPOT' : `$${prize.value}`);
                span.textContent = valueText;
                span.style.transform = `rotate(${-rotation}deg) translate(-50%, -${radiusOffset}px)`;
                span.style.fontSize = `${Math.max(14, Math.round((wheel.clientWidth || 300) * 0.06))}px`;

                label.appendChild(span);
                labelsContainer.appendChild(label);
            });
        }

        function spinWheel() {
            if (gameData.gameStates.wheelSpinning) return;
            
            const now = Date.now();
            const lastSpin = gameData.gameStates.lastFreeSpin;
            const isFreeSpin = now - lastSpin >= 24 * 60 * 60 * 1000; 
            
            if (!isFreeSpin && gameData.balance < 1000) {
                showNotification('You need at least $1000 to spin the wheel!', 'error');
                return;
            }
            
            if (!isFreeSpin) {
                gameData.balance -= 1000;
                updateBalance();
            }
            
            const button = document.getElementById('wheelSpinBtn');
            if (button) {
                animateButton(button);
                button.disabled = true;
            }
            gameData.gameStates.wheelSpinning = true;
            const centerButton = document.getElementById('spinWheelBtn');
            if (centerButton) {
                animateButton(centerButton);
                centerButton.classList.add('disabled');
            }
            
            const wheel = document.getElementById('wheelSpin');
            const spinDuration = 5000; 
            const rotations = 6; 
            
            const prizeWeights = [30, 25, 20, 15, 8, 2, 0.1];
            let totalWeight = prizeWeights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            let selectedIndex = 0;
            
            for (let i = 0; i < prizeWeights.length; i++) {
                if (random < prizeWeights[i]) {
                    selectedIndex = i;
                    break;
                }
                random -= prizeWeights[i];
            }
            
            const angle = 360 / gameData.gameStates.wheelPrizes.length;
            const randomOffset = (Math.random() - 0.5) * angle * 0.5;
            const finalRotation = (rotations * 360) + (selectedIndex * angle) + (angle / 2) + randomOffset;

            wheel.style.transition = `transform ${spinDuration}ms cubic-bezier(0.17, 0.67, 0.12, 0.99)`;
            wheel.style.transform = `rotate(${-finalRotation}deg)`;
            wheel.dataset.rotation = finalRotation % 360;

            setTimeout(() => {
                gameData.gameStates.wheelSpinning = false;
                if (button) {
                    button.disabled = false;
                }
                if (centerButton) {
                    centerButton.classList.remove('disabled');
                }
                
                const prize = gameData.gameStates.wheelPrizes[selectedIndex];
                let winnings = 0;
                let message;
                
                if (prize.value === 'JACKPOT') {
                    winnings = gameData.gameStates.slotsJackpot;
                    gameData.gameStates.slotsJackpot = 10000;
                    message = `🎉 JACKPOT! You won $${winnings.toLocaleString()}!`;
                    showNotification('WHEEL JACKPOT!!!', 'success');
                } else {
                    winnings = prize.value;
                    message = `🎉 You won $${winnings}!`;
                    showNotification(`Won $${winnings} on the wheel!`, 'success');
                }
                
                gameData.balance += winnings;
                gameData.totalWon += winnings;
                updateBalance();
                updateProgress();
                updateJackpotDisplay();
                
                if (isFreeSpin) {
                    message += ' (Free Spin)';
                    gameData.gameStates.lastFreeSpin = now;
                }
                updateFreeSpinTimer();
                
                showResult('wheelResult', message, true);
                addToHistory('wheel', message, true, { type: isFreeSpin ? 'daily' : 'spin' });
                checkAchievements();
                saveGameData();
            }, spinDuration);
        }

        function checkFreeSpin() {
            const now = Date.now();
            const lastSpin = gameData.gameStates.lastFreeSpin;
            
            if (now - lastSpin >= 24 * 60 * 60 * 1000) {
                document.getElementById('wheelSpinBtn').innerHTML = '<i class="fas fa-gift"></i> FREE Spin Available!';
                document.getElementById('nextFreeSpin').style.display = 'none';
            } else {
                updateFreeSpinTimer();
            }
        }

        function updateFreeSpinTimer() {
            const now = Date.now();
            const lastSpin = gameData.gameStates.lastFreeSpin;
            const nextSpin = lastSpin + 24 * 60 * 60 * 1000;
            const remaining = nextSpin - now;
            
            if (remaining <= 0) {
                document.getElementById('wheelSpinBtn').innerHTML = '<i class="fas fa-gift"></i> FREE Spin Available!';
                document.getElementById('nextFreeSpin').style.display = 'none';
                return;
            }
            
            const hours = Math.floor(remaining / (60 * 60 * 1000));
            const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
            
            document.getElementById('wheelSpinBtn').innerHTML = '<i class="fas fa-gift"></i> Spin Wheel ($1000)';
            document.getElementById('nextFreeSpin').textContent = `Next free spin: ${hours}h ${minutes}m`;
            document.getElementById('nextFreeSpin').style.display = 'block';
            
            setTimeout(updateFreeSpinTimer, 60000);
        }

        function setActiveTab(tabName, skipPersist = false) {
            const tabElement = document.getElementById(`${tabName}-tab`);
            const buttonElement = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);

            if (!tabElement || !buttonElement) {
                if (tabName !== 'loan') {
                    setActiveTab('loan', skipPersist);
                }
                return;
            }

            document.querySelectorAll('.game-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            tabElement.classList.add('active');
            buttonElement.classList.add('active');

            if (tabElement.id === 'bonus-tab') {
                checkFreeSpin();
            }

            if (!skipPersist) {
                localStorage.setItem('casinoEmpireActiveTab', tabName);
            }
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                setActiveTab(btn.dataset.tab);
            });
        });

        window.addEventListener('load', initGame);

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
            }
        });

        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('change', function() {
                if (this.value < 1) {
                    this.value = 1;
                }
            });
        });
    </script>



</body></html>
